#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
\input colordvi
\usepackage{color}
\fancyhead{}
\fancyfoot[CE,CO]{}
\newtoks{\addressee} \global\addressee={}
\newdimen\longindent \longindent=3.5truein
\fancyhead[L]{Memo to: \the\addressee \\ \datetoday \\ Page \thepage \hfill}
\renewcommand{\headrulewidth}{0.0pt}
\newenvironment{lyxlist}[1]
{\begin{list}{}
{\settowidth{\labelwidth}{#1}
\setlength{\leftmargin}{\labelwidth}
\addtolength{\leftmargin}{\labelsep}
\renewcommand{\makelabel}[1]{##1\hfil}}}
{\end{list}}
\newcommand{\datetoday}{\number\day\space
     \ifcase\month\or January\or February\or March\or April\or May\or
     June\or July\or August\or September\or October\or November\or
     December\fi
     \space\number\year}
\newcommand{\EOLmemo}{\null \vskip-1.5truein
{\raggedright \textsf{\textsc{\large \textcolor{blue}{Earth Observing Laboratory}}}}\par
{\raggedright \textsf{\textsl{\textcolor{blue}{Memorandum:}}}} \par \vskip6pt
{\color{blue}{\hrule}}\par
\vskip0.3truein \leftline{\hskip \longindent \datetoday} \vskip0.2truein
\thispagestyle{empty}}
\newcommand{\attachm}[1]{\begin{lyxlist}{Attachments:00}
\item [Attachments:] {#1}
\end{lyxlist}}
\newcommand{\cc}[1]{\begin{lyxlist}{Attachments:00}
\item [cc:] {#1}
\end{lyxlist}}
\newcommand{\attach}[1]{\begin{lyxlist}{Attachments:00}
\item [Attachment:] {#1}
\end{lyxlist}}
%usage: \encl{A\\B\\C} or \cc{ma,e1\\name2\\name3}
\end_preamble
\use_default_options false
\begin_modules
knitr
\end_modules
\maintain_unincluded_children false
\language english
\language_package auto
\inputencoding default
\fontencoding global
\font_roman "times" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize letterpaper
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 0
\use_package mathdots 0
\use_package mathtools 1
\use_package mhchem 0
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine natbib
\cite_engine_type authoryear
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2.54cm
\topmargin 3.54cm
\rightmargin 2.54cm
\bottommargin 2.54cm
\headheight 1cm
\headsep 2cm
\footskip 0.5cm
\secnumdepth 2
\tocdepth 2
\paragraph_separation skip
\defskip medskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle fancy
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
EOLmemo 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
global
\backslash
addressee={KalmanFilter archive}  % >>change "File" to the "To:" name desired
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="2">
<features tabularvalignment="middle">
<column alignment="left" valignment="top" width="0pt">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
To:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
the
\backslash
addressee
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
From:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
William Cooper
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Subject:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
workflow for generating this report
\begin_inset Note Note
status open

\begin_layout Plain Layout
XXX or comments flag changes needing attention
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
bigskip
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<initialization,echo=FALSE,include=FALSE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

library(knitr)
\end_layout

\begin_layout Plain Layout

opts_chunk$set(echo=FALSE, include=FALSE, fig.lp="fig:")
\end_layout

\begin_layout Plain Layout

opts_chunk$set(fig.width=6, fig.height=5, fig.pos="center", digits=4)
\end_layout

\begin_layout Plain Layout

thisFileName <- "WorkflowAttitudeAngleNote"
\end_layout

\begin_layout Plain Layout

require(Ranadu, quietly = TRUE, warn.conflicts=FALSE)
\end_layout

\begin_layout Plain Layout

require(ggplot2)
\end_layout

\begin_layout Plain Layout

require(grid)
\end_layout

\begin_layout Plain Layout

require(ggthemes)
\end_layout

\begin_layout Plain Layout

Directory <- DataDirectory ()
\end_layout

\begin_layout Plain Layout

Flight <- "rf01" 				# XXX change this
\end_layout

\begin_layout Plain Layout

Project = "DEEPWAVE"			 # XXX change this
\end_layout

\begin_layout Plain Layout

ProjectDir <- "DEEPWAVE"
\end_layout

\begin_layout Plain Layout

fname = sprintf("%s%s/%s%s.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

Data <- getNetCDF (fname, standardVariables())		#XXX set variables needed
 here
\end_layout

\begin_layout Plain Layout

SaveRData <- sprintf("%s.Rdata", thisFileName)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Section
Purpose
\end_layout

\begin_layout Standard
This workflow description documents the steps leading to the code in 
\begin_inset Quotes eld
\end_inset

KalmanFilter.Rnw
\begin_inset Quotes erd
\end_inset

 and provides additional detail not in the report 
\begin_inset Quotes eld
\end_inset

KalmanFilter.pdf.
\begin_inset Quotes erd
\end_inset

 KalmanFilter.Rnw contains both text (in \SpecialChar LaTeX
 format) and R processing script
 for the analyses in the resulting report on the development of a Kalman
 filter for use with measurements from the NSF/NCAR Gulfstream 5 research
 aircraft.
 The description of workflow provided here includes the process of collecting
 the observations and processing them to data files, the data archives used,
 the steps required to generate the plots and other results including the
 instances where manual intervention is required to identify appropriate
 subsets of the data, the relevant R code and \SpecialChar LaTeX
 documents, and all the steps
 leading to the generation of the text in the manuscript.
 "KalmanFilter.Rnw" is the authoritative reference, but this overview and
 these diagrams will help explain the workflow at a general level and so
 should substitute for reading the R and \SpecialChar LaTeX
 code in most cases.
 The intent is to describe the workflow in sufficient detail to support
 replication of the analysis and figures presented in the report, to facilitate
 changes based on new data or new analysis approaches, and to make it practical
 to apply the proposed algorithms to data collected by research aircraft
 used in atmospheric studies.
\end_layout

\begin_layout Standard
The document 
\begin_inset Quotes eld
\end_inset

KalmanFilter.pdf
\begin_inset Quotes erd
\end_inset

 is intended to be an internal technical note, but may be suitable to accompany
 a separate proposed journal article that describes alternate and simpler
 methods for correcting attitude angles.
 Both this document and that proposed publication augment the material presented
 in the NCAR Technical Note 
\begin_inset Quotes eld
\end_inset

Uncertainty in Measurements of Wind from the NSF/NCAR Gulfstream Aircraft
\begin_inset Quotes erd
\end_inset

 
\begin_inset CommandInset citation
LatexCommand cite
key "Cooper2016ncartn"

\end_inset

.
 
\end_layout

\begin_layout Section
Acquisition of the primary data
\end_layout

\begin_layout Standard
The measurements used in this report were collected using the NSF/NCAR GV
 research aircraft during the DEEPWAVE project of 2014.
 The onboard data-acquisition program 'aeros' recorded the data in digital
 format, and those data files were then processed by the program 'nimbus'
 to produce an archive in NetCDF format.
 The software management group of NCAR/EOL maintains a version-controlled
 archive of these programs, so if they are of interest they can be obtained
 by contacting the data-management group of EOL (
\begin_inset CommandInset href
LatexCommand href
name "at this "
target "raf-dm@eol.ucar.edu"
type "mailto:"

\end_inset

 or 
\begin_inset CommandInset href
LatexCommand href
name "this"
target "datahelp@eol.ucar.edu"
type "mailto:"

\end_inset

 address).
 The data files available from NCAR/EOL can be found at links on 
\begin_inset CommandInset href
LatexCommand href
name "this URL"
target "https://www.eol.ucar.edu/all-field-projects-and-deployments"

\end_inset

.
 The details of the processing algorithms are documented here: 
\begin_inset CommandInset href
LatexCommand href
name "Processing Algorithms"
target "https://drive.google.com/open?id=0B1kIUH45ca5Ab2Z6cld1M1cydjA"

\end_inset

.
 These procedures as they pertain to the measurement of wind are also documented
 in 
\begin_inset CommandInset citation
LatexCommand cite
key "Cooper2016ncartn"

\end_inset

.
 The resulting data files contain measurements in scientific units and brief
 descriptions of each measurement, included as netCDF attributes for the
 files and for each variable.
\end_layout

\begin_layout Standard
One special file was generated and used in KalmanFilter.Rnw, a netCDF file
 named DWIRUrf15HR.nc.
 It was generated by the program nimbus (version of January 2016) by specifying
 a 25-Hz data rate and by including the variables needed for the 
\begin_inset Quotes eld
\end_inset

mechanization
\begin_inset Quotes erd
\end_inset

 described in this report.
 That file is not part of the standard project archives and so must be obtained
 separately, as described in the 
\begin_inset Quotes eld
\end_inset

Reproducibility
\begin_inset Quotes erd
\end_inset

 appendix to the report.
\end_layout

\begin_layout Section
The KalmanFilter.Rnw file
\end_layout

\begin_layout Standard
The .Rnw file is basically \SpecialChar LaTeX
 text, generated for simplicity using \SpecialChar LyX
 and exported
 to .Rnw format and then processed in RStudio (
\begin_inset CommandInset citation
LatexCommand citet
key "RStudio2012"

\end_inset

).
 The .lyx file (KalmanFilter.lyx) will run equivalently and produce a PDF-format
 version of the manuscript.
 Within the .Rnw file or within the .lyx file there are 
\begin_inset Quotes eld
\end_inset

chunks
\begin_inset Quotes erd
\end_inset

 of R code (
\begin_inset CommandInset citation
LatexCommand citet
key "Rlanguage"

\end_inset

), delineated by a header having this format:
\end_layout

\begin_layout LyX-Code
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout LyX-Code
<<title, var=setting, ...>>=
\end_layout

\begin_layout LyX-Code
...R code...
\end_layout

\begin_layout LyX-Code
@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
These chunks generate plots and other results of analyses that are incorporated
 into the manuscript using 'knitr' (
\begin_inset CommandInset citation
LatexCommand citet
key "Xie2014a,Xie2014b"

\end_inset

).
 In RStudio, the chunks appear as gray sections in the file when it is edited.
 Where tasks involve execution of R code, the chunk containing the code
 is referenced in the discussion below.
 Any results from the processing can be incorporated into the \SpecialChar LaTeX
 text via
 
\begin_inset Quotes eld
\end_inset


\backslash
Sexpr{}
\begin_inset Quotes erd
\end_inset

 calls embedded in the \SpecialChar LaTeX
 portion of the file.
\end_layout

\begin_layout Standard
Two 
\begin_inset Quotes eld
\end_inset

switches
\begin_inset Quotes erd
\end_inset

 serve to speed execution of the code: (1) 
\begin_inset Quotes eld
\end_inset

ReloadData,
\begin_inset Quotes erd
\end_inset

 which when TRUE causes the original archive data files to be read; and
 the option 
\begin_inset Quotes eld
\end_inset

cache
\begin_inset Quotes erd
\end_inset

 which, when true, causes previously generated subsets of the results to
 be re-used as saved in a subdirectory 
\begin_inset Quotes eld
\end_inset

cache.
\begin_inset Quotes erd
\end_inset

 Both are provided to speed execution in cases where small changes are made.
 When ReloadData is FALSE subsets of data files previously saved as 
\begin_inset Quotes eld
\end_inset

Rdata
\begin_inset Quotes erd
\end_inset

 files are restored to R data.frames, a process that is much faster than
 re-reading the original archive data file.
 If cache is FALSE all calculations are performed, but using 
\begin_inset Quotes eld
\end_inset

cache=TRUE
\begin_inset Quotes erd
\end_inset

 is usually much faster after the first run.
 
\end_layout

\begin_layout Standard
The file and the report are organized into three main sections: (1) an overview,
 providing background and the purpose and justification for the Kalman filter;
 (2) a description of the 
\begin_inset Quotes eld
\end_inset

mechanization
\begin_inset Quotes erd
\end_inset

 developed to replicate the performance of the inertial navitation system;
 and (3) a description of the Kalman filter itself, with illustrative results.
 The second and third sections are discussed in detail in this workflow
 document, which is in turn generated by a \SpecialChar LyX
 file (
\begin_inset Quotes eld
\end_inset

WorkflowKalmanFilter.lyx
\begin_inset Quotes erd
\end_inset

).
 
\end_layout

\begin_layout Section
Required R packages including Ranadu
\end_layout

\begin_layout Standard
The R code used for analysis reported in this paper relies heavily on a
 package of routines for R called 
\begin_inset Quotes eld
\end_inset

Ranadu.
\begin_inset Quotes erd
\end_inset

 This is a set of R scripts for working with the NetCDF archive data files
 produced by NCAR/EOL/RAF, and it includes some convenience routines for
 generating plots and performing other data-analysis tasks with the archived
 data.
 The Ranadu package is available at this 
\begin_inset CommandInset href
LatexCommand href
name "GitHub address"
target "https://github.com/WilliamCooper/Ranadu.git"

\end_inset

.
 To run the R code referenced here, that package should be included in the
 R installation.
 The KalmanFilter.Rnw routine requires that package and also some others
 referenced in the file, including 
\begin_inset Quotes eld
\end_inset

knitr
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

ggplot2
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

grid
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

ggthemes
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

zoo
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

signal
\begin_inset Quotes erd
\end_inset

.
 In addition, Ranadu requires 
\begin_inset Quotes eld
\end_inset

ncdf4
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

tcltk
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

stats
\begin_inset Quotes erd
\end_inset

, and 
\begin_inset Quotes eld
\end_inset

reshape2
\begin_inset Quotes erd
\end_inset

, and the R code requires package 
\begin_inset Quotes eld
\end_inset

numDeriv
\begin_inset Quotes erd
\end_inset

 for its Jacobian function.
 Some parts of 
\begin_inset Quotes eld
\end_inset

Ranadu
\begin_inset Quotes erd
\end_inset

 reference additional packages as needed, but they are not used in KalmanFilter.R
nw so do not need to be available for this routine to run.
\end_layout

\begin_layout Standard
The data processing for this manuscript involved revising some parts of
 the Ranadu package, as listed below.
 The relative timing among measurements is particularly important in this
 study, so some development of utilities to aid in studies of timing was
 useful.
 The netCDF files sometimes have mixed rates, e.g., 5_Hz for GPS-provided
 measurements and 25
\begin_inset space ~
\end_inset

Hz for some others including interpolation to 25
\begin_inset space ~
\end_inset

Hz from 13
\begin_inset space ~
\end_inset

Hz for IRS-provided measurements.
 In 
\begin_inset Quotes eld
\end_inset

Ranadu
\begin_inset Quotes erd
\end_inset

, this is handled appropriately in the 
\begin_inset Quotes eld
\end_inset

getNetCDF()
\begin_inset Quotes erd
\end_inset

 routine, sometimes with the 
\begin_inset Quotes eld
\end_inset

ShiftInTime()
\begin_inset Quotes erd
\end_inset

 routine to adjust for delays among the variables and the 
\begin_inset Quotes eld
\end_inset

SmoothInterp()
\begin_inset Quotes erd
\end_inset

 routine to interpolate for missing values and apply smoothing of signals.
 Most of the plots are generated using 
\begin_inset Quotes eld
\end_inset

plotWAC()
\begin_inset Quotes erd
\end_inset

, which is a convenience routine that sets various options preferred by
 the author.before calling the R 
\begin_inset Quotes eld
\end_inset

plot()
\begin_inset Quotes erd
\end_inset

 routine.
\end_layout

\begin_layout Subsection
Ranadu::getNetCDF () modifications
\end_layout

\begin_layout Standard
To handle data files with mixed-rate variables (e.g., 5-Hz GPS but 25-Hz IRS
 and others at 1 Hz), this script for reading the netCDF data files incorporates
 code to produce a single-rate R data.frame.
 For this purpose, there is a function 
\begin_inset Quotes eld
\end_inset

IntFilter()
\begin_inset Quotes erd
\end_inset

 in that script that interpolates and filters variables.
 The RAF data archives follow the convention that each sample is tagged
 with a time that is the 
\emph on
beginning
\emph default
 of the time interval, not the center.
 For example, for 50-Hz samples averaged to one second, the sample represents
 the average of 50 samples beginning at the specified time and so should
 be interpreted as a sample average at 0.5
\begin_inset space ~
\end_inset

s past that specified time.
 The 
\begin_inset Quotes eld
\end_inset

IntFilter()
\begin_inset Quotes erd
\end_inset

 routine observes this convention by interpolating a low-rate sample to
 the specified higher rate and then shifting the resulting time series forward
 in time by half the original time interval, with duplication of the first
 measurement to fill the initial 1/2-period slots and also replication of
 the trailing 1/2-period slots that are not filled by the linear interpolation
 routine.
 Tests verified that this provided an appropriate representation of the
 measurement as interpolated to the higher rate and shifted forward to match
 other higher-rate measurements.
\end_layout

\begin_layout Subsection
Ranadu::ShiftInTime ()
\begin_inset CommandInset label
LatexCommand label
name "subsec:ShiftInTime"

\end_inset


\end_layout

\begin_layout Standard
To shift time series variables forward or backward, this new function was
 added to the 
\begin_inset Quotes eld
\end_inset

Ranadu
\begin_inset Quotes erd
\end_inset

 package.
 The function interpolates the supplied time series to a higher rate (125
\begin_inset space ~
\end_inset

Hz), uses the R function 
\begin_inset Quotes eld
\end_inset

stats::approx()
\begin_inset Quotes erd
\end_inset

 for linear interpolation, shifts the interpolated series an appropriate
 number of bins forward or backward (duplicating or truncating the end values
 as necessary), optionally applies a Savitzgky-Golay smoothing filter, and
 then returns an appropriate subset to represent the time series at the
 original sample rate.
\end_layout

\begin_layout Subsection
Ranadu::XformLA ()
\begin_inset CommandInset label
LatexCommand label
name "subsec:XformLA"

\end_inset


\end_layout

\begin_layout Standard
The algorithm for heading correction requires that the accelerations measured
 by an inertial navigation system (IRS) be transformed from the aircraft
 or 
\begin_inset Formula $a$
\end_inset

-frame reference coordinates to a local-level Earth-relative frame or 
\begin_inset Formula $l$
\end_inset

-frame in which the {x, y, z} coordinates are respectively east, north,
 and up.
 This transformation was coded as a new 
\begin_inset Quotes eld
\end_inset

Ranadu
\begin_inset Quotes erd
\end_inset

 function.
 This function takes as input a data.frame containing the attitude angles
 measured by the INS in variables named PITCH, ROLL, and THDG (true heading),
 all in units of degrees.
 It transforms an 
\begin_inset Formula $a$
\end_inset

-frame vector to an 
\begin_inset Formula $l$
\end_inset

-frame vector and returns the result.
 It would be preferable to do this in vectorized form, but such a representation
 hasn't yet been found, so the function uses a loop.
 As noted in the routine, the approach using R 'apply()' functions was slower
 than the loop, but that is because the specific approach tried here is
 likely unnecessarily convoluted.
 This is an area of needed improvement, but the loop as coded is practical
 and adequate for this study.
 The routine also accepts an 
\begin_inset Quotes eld
\end_inset

inverse
\begin_inset Quotes erd
\end_inset

 argument with default value FALSE; when true, the transformation is from
 the 
\emph on
l-
\emph default
frame to the 
\emph on
a-
\emph default
frame instead.
\end_layout

\begin_layout Standard
The transformation coded in this routine was obtained in standard ways using
 rotations 
\begin_inset Formula $\phi$
\end_inset

 about the roll axis, then 
\begin_inset Formula $\theta$
\end_inset

 about the pitch axis, and then 
\begin_inset Formula $\psi$
\end_inset

 about the heading axis.
 The text lists sources for this transformation, but they differ from the
 matrix used here in that this transformation starts from what is called
 here the 
\begin_inset Formula $a$
\end_inset

-frame or aircraft reference frame with 
\begin_inset Formula $x$
\end_inset

 forward, 
\begin_inset Formula $y$
\end_inset

 starboard, and 
\begin_inset Formula $z$
\end_inset

 downward and transforms to the local frame or 
\begin_inset Formula $l$
\end_inset

-frame with 
\begin_inset Formula $x$
\end_inset

 east, 
\begin_inset Formula $y$
\end_inset

 north, and 
\begin_inset Formula $z$
\end_inset

 upward.
 The transformation matrix 
\begin_inset Formula $\mathbf{R}_{a}^{l}$
\end_inset

 is obtained as follows, where the first matrix changes the axis definitions:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\mathbf{R}_{a}^{l}=\left(\begin{array}{ccc}
0 & 1 & 0\\
1 & 0 & 0\\
0 & 0 & -1
\end{array}\right)\left(\begin{array}{ccc}
\cos\psi & -\sin\psi & 0\\
\sin\psi & \cos\psi & 0\\
0 & 0 & 1
\end{array}\right)\left(\begin{array}{ccc}
\cos\theta & 0 & -\sin\theta\\
0 & 1 & 0\\
\sin\theta & 0 & \cos\theta
\end{array}\right)\left(\begin{array}{ccc}
1 & 0 & 0\\
0 & \cos\phi & \sin\phi\\
0 & -\sin\phi & \cos\phi
\end{array}\right)
\]

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
R_{a}^{l}=\begin{bmatrix}\sin\psi\cos\theta & \sin\psi\sin\theta\sin\phi+\cos\psi\cos\phi & \cos\psi\sin\phi-\sin\psi\sin\theta\cos\phi\\
\cos\psi\cos\theta & \cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi & -\cos\psi\sin\theta\cos\phi-\sin\psi\sin\phi\\
-\sin\theta & \cos\theta\sin\phi & -\cos\theta\cos\phi
\end{bmatrix}\label{eq:XformLA}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
Comments on 
\begin_inset Quotes eld
\end_inset

The components of the derivatives
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Standard
The calculations are explained in the document, but it may be useful to
 elaborate on some of the choices that were made in regard to corrections
 for inertial effects.
 Such corrections enter during calculation of the accelerations and again
 during calculations of the rate of change in attitude angles.
\end_layout

\begin_layout Subsection
Accelerations
\end_layout

\begin_layout Standard
There are two corrections needed if the accelerations measured in the a-frame
 are to be used in the l-frame.
 First, a correction must be made for the Coriolis acceleration that arises
 from motion relative to a spherical Earch.
 In addition, a correction is needed because the l-frame itself moves and
 remains oriented to match the local-level orientation.
 The Coriolis acceleration is
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{C}_{c}=-2\boldsymbol{\Omega}_{e}\times\boldsymbol{V}\label{eq:Coriolis}
\end{equation}

\end_inset

where 
\begin_inset Formula $\boldsymbol{\Omega_{e}}$
\end_inset

 is the angular rotation rate of the Earch and 
\begin_inset Formula $\boldsymbol{V}$
\end_inset

 is the velocity of the aircraft relative to the Earth.
 
\end_layout

\begin_layout Standard
In the R code, this equation and others involving vector cross products
 is represented in a skew-symmetric matrix, so this choice merits some explanati
on.
 Strangely, core R mathematical functions do not include the cross product
 needed by this equation.
 Instead, in R, the 
\begin_inset Quotes eld
\end_inset

cross product
\begin_inset Quotes erd
\end_inset

 has a different meaning.
 Of course, there are many solutions that contributors have produced that
 could be used, but it seemed awkward to use a non-standard package for
 such a basic function, and it seemed appropriate to select a solution that
 ensured reproducibility in the future.
 The representation of the cross product via a skew-symmetric matrix provides
 such a solution, but it is unfamiliar to many, so an elaboration is provided
 here: If an angular-rotation vector has coordinates 
\begin_inset Formula $\boldsymbol{{\bf \omega}}=(\omega_{1},\,\omega_{2},\,\omega_{3})$
\end_inset

 then the skew-symmetric representation is 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{S}=\left(\begin{array}{ccc}
0 & -\omega_{3} & \omega_{2}\\
\omega_{3} & 0 & -\omega_{1}\\
-\omega_{2} & \omega_{1} & 0
\end{array}\right)\label{eq:skew-symmetric}
\end{equation}

\end_inset

Then the cross produce 
\begin_inset Formula $\boldsymbol{\omega}\times\boldsymbol{\mathbf{V}}$
\end_inset

 can be found by matrix multiplication via 
\begin_inset Formula $\boldsymbol{S\thinspace V}$
\end_inset

 with 
\begin_inset Formula $\boldsymbol{V}$
\end_inset

 the column matrix representing the velocity.
 This equality can be verified by comparing the result of the matrix multiplicat
ion to the standard formula for the vector product.
 In particular, the vector representing the rotation of the Earth (
\begin_inset Formula $\omega_{ie}^{l}$
\end_inset

, where the notation denotes the rotation rate of the Earth relative to
 an inertial frame, as observed in the l-frame) has components (0, 
\begin_inset Formula $\omega_{e}\cos\lambda,$
\end_inset

 
\begin_inset Formula $\omega_{e}\sin\lambda$
\end_inset

) where 
\begin_inset Formula $\omega_{e}$
\end_inset

 is the rotation rate and 
\begin_inset Formula $\lambda$
\end_inset

 is the latitude, so the Coriolis acceleration can be represented by
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{C}_{c}=-2\omega_{e}\left(\begin{array}{ccc}
0 & -\sin\lambda & \cos\lambda\\
\sin\lambda & 0 & 0\\
-\cos\lambda & 0 & 0
\end{array}\right)\left(\begin{array}{c}
V_{1}\\
V_{2}\\
V_{3}
\end{array}\right)\label{eq:Cor-matrix}
\end{equation}

\end_inset

This is the form chosen to represent the Coriolis acceleration in the derivative
 function.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

, p.
\begin_inset space ~
\end_inset

179, give the components of the rotation rate of the l-frame relative to
 the Earth, as expressed in the l-frame, as 
\begin_inset Formula $\omega_{el}^{l}=(-V_{2}/(R_{m}+h),\,V_{1}/(R_{n}+h),\,V_{1}\tan\lambda/(R_{n}+h)$
\end_inset

 where 
\begin_inset Formula $R_{m}$
\end_inset

 and 
\begin_inset Formula $R_{n}$
\end_inset

 are respectively the meridional and normal radii of the earth, and 
\begin_inset Formula $h$
\end_inset

 is the altitude above the Earth.
 Expressed as a skew-symmetric matrix, this isel the other component used
 to correct the measured accelerations when transforming from the a-frame
 to the l-frame.
\end_layout

\begin_layout Subsection
Attitude angles
\end_layout

\begin_layout Standard
The approach to finding the derivatives of the attitude angles is to find
 the derivative (
\begin_inset Formula $\dot{R_{a}^{l}})$
\end_inset

 of the transformation matrix from the a-frame to the l-frame and then find
 the attitude-angle derivatives from the definition of the transformation
 matrix.
\begin_inset Foot
status open

\begin_layout Plain Layout
This material relies heavily on the development in 
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

, pp.
\begin_inset space ~
\end_inset

178–180.
\end_layout

\end_inset

 The steps are these:
\end_layout

\begin_layout Enumerate
The IRU measures the rotation rate 
\begin_inset Formula $\omega_{ia}^{a}$
\end_inset

 of the a-frame relative to an inertial frame, as observed in the a-frame.
 In the a-frame, the roll axis is the x-axis forward along the longitudinal
 axis of the aircraft, the pitch axis is the y-axis to starboard, and the
 yaw axis is the downward z-axis but with a sign reversal arising from inverse
 relationship between yaw angle and heading angle, so 
\begin_inset Formula $\omega_{ia}^{a}=(\mathrm{BROLLR},\,\mathrm{BPITCHR},\,-\mathrm{BYAWR)}$
\end_inset

.
\end_layout

\begin_layout Enumerate
The derivative needed to find (
\begin_inset Formula $\dot{R_{a}^{l}})$
\end_inset

 is instead the rotation rate of the a-frame relative to the l-frame, as
 observed in the a-frame (
\begin_inset Formula $\omega_{la}^{a}$
\end_inset

).
 This differs from 
\begin_inset Formula $\omega_{ia}^{a}$
\end_inset

 by the rotation rate of the l-frame relative to the a-frame, as observed
 in an inertial frame (
\begin_inset Formula $\omega_{il}^{a}$
\end_inset

): 
\begin_inset Formula $\omega_{la}^{a}=\omega_{ia}^{a}-\omega_{il}^{a}$
\end_inset

.
 Transforming 
\begin_inset Formula $\omega_{la}^{a}$
\end_inset

 from the a-frame to the l-frame then gives the desired derivative 
\begin_inset Formula $\dot{R_{a}^{l}}$
\end_inset

.
\end_layout

\begin_layout Enumerate
As for velocity, the term 
\begin_inset Formula $\omega_{il}^{a}$
\end_inset

 contains two contributions, one from the rotation of the Earth (
\begin_inset Formula $\omega_{ie}^{a}$
\end_inset

) and the second from the rotation of the l-frame relative to an inertial
 frame (
\begin_inset Formula $\omega_{el}^{a}$
\end_inset

).
 The first can be obtained by transforming 
\begin_inset Formula $\omega_{ie}^{l}$
\end_inset

 as defined in the previous subsection to the a-frame, and the second also
 is obtained by transforming 
\begin_inset Formula $\omega_{el}^{l}$
\end_inset

 as defined previously to the a-frame.
 The appropriate transformation is the inverse of 
\begin_inset Formula $R_{a}^{l}$
\end_inset

, denoted 
\begin_inset Formula $R_{l}^{a}=t(R_{a}^{l}$
\end_inset

) where 
\begin_inset Quotes eld
\end_inset


\begin_inset Formula $t"$
\end_inset

denotes the matrix transpose operator: 
\begin_inset Formula $\omega_{ie}^{a}=R_{l}^{a}\omega_{ie}^{l}$
\end_inset

 and 
\begin_inset Formula $\omega_{el}^{a}=R_{l}^{a}\omega_{el}^{l}$
\end_inset

.
 In the code, this is replaced by the skew-symmetric equivalent: If 
\begin_inset Formula $\boldsymbol{\Omega}^{l}$
\end_inset

 is the skew-symmetric representation of 
\begin_inset Formula $\omega_{ie}^{l}+\omega_{el}^{l}$
\end_inset

, the representation in the a-frame is 
\begin_inset Formula $\boldsymbol{\Omega}^{a}=R_{l}^{a}\boldsymbol{\Omega}^{l}R_{a}^{l}$
\end_inset

.
\end_layout

\begin_layout Enumerate
Expressing 
\begin_inset Formula $\omega_{ia}^{a}$
\end_inset

 also as a skew-symmetric matrix, following (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:skew-symmetric"

\end_inset

), and subtracting 
\begin_inset Formula $\boldsymbol{\Omega}^{a}$
\end_inset

 from it, gives a skew-symmetric matrix that, when multiplied by 
\begin_inset Formula $R_{a}^{l}$
\end_inset

, gives the desired derivative 
\begin_inset Formula $\dot{\boldsymbol{R}_{a}^{l}}$
\end_inset

.
 
\end_layout

\begin_layout Enumerate
The attitude angles can be found from the definitions of the transformation
 matrix, as specified by (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:XformLA"

\end_inset

):
\begin_inset Formula 
\begin{eqnarray*}
\theta & = & \arcsin(-R_{l}^{a}[3,1])\\
\phi & = & \arctan2(R_{l}^{a}[3,2],\,-R_{l}^{a}[3,3])\\
\Psi & = & \arctan2(R_{l}^{a}[1,1],\,R_{l}^{a}[2,1])
\end{eqnarray*}

\end_inset

The derivatives of the attitude angles are then given by the derivatives
 of the arcsin and arctan functions:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{eqnarray*}
\frac{d(\arcsin(x))}{dx} & = & \frac{1}{\sqrt{1-x^{2}}}\\
\frac{d(\arctan(x))}{dx} & = & \frac{1}{1+x^{2}}\\
\dot{\theta} & = & \frac{-1}{\sqrt{1-R_{l}^{a}[3,1]^{2}}}\dot{R}_{l}^{a}[3,1]\\
\dot{\phi} & = & \frac{1}{1+\left(R_{l}^{a}[3,2]/R_{l}^{a}[3.3]\right)^{2}}\frac{R_{l}^{a}[3,2]}{R_{l}^{a}[3,3]}\left(\frac{\dot{R}_{l}^{a}[3,3]}{R_{l}^{a}[3,3]}-\frac{\dot{R}_{l}^{a}[3,2]}{R_{l}^{a}[3,2]}\right)\\
\dot{\psi} & = & \frac{1}{1+\left(R_{l}^{a}[1,1]/R_{l}^{a}[2,1]\right)^{2}}\frac{R_{l}^{a}[1,1]}{R_{l}^{a}[2,1]}\left(\frac{\dot{R}_{l}^{a}[1,1]}{R_{l}^{a}[1,1]}-\frac{\dot{R}_{l}^{a}[2,1]}{R_{l}^{a}[2,1]}\right)\\
 & = & \frac{1}{1+\left(R_{l}^{a}[1,1]/R_{l}^{a}[2,1]\right)^{2}}\left(\frac{\dot{R}_{l}^{a}[1,1]}{R_{l}^{a}[2,1]}-\frac{\dot{R}_{l}^{a}[2,1]R_{l}^{a}[1,1]}{R_{l}^{a}[2,1]^{2}}\right)
\end{eqnarray*}

\end_inset

Because 
\begin_inset Formula $R_{l}^{1}[2,1]$
\end_inset

 (equal to 
\begin_inset Formula $\cos\psi\cos\theta$
\end_inset

) can pass through zero for heading of 90 or 270
\begin_inset Formula $^{\circ},$
\end_inset

 some numerical problems arise when the last equation is used.
 (Avoiding similar problems at the zero for 
\begin_inset Formula $R_{l}^{a}[1,1]$
\end_inset

 is the justification for using the second form of the last equation.) For
 small 
\begin_inset Formula $R_{l}^{a}[2,1]$
\end_inset

, the last equation becomes
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\dot{\psi}=\left(\frac{R_{l}^{a}[2,1]\dot{R}_{l}^{a}[1,1]}{R_{l}^{a}[1,1]^{2}}-\frac{\dot{R}_{l}^{a}[2,1]}{R_{l}^{a}[1,1]}\right)
\]

\end_inset

which avoids the singularity, so this form will be used when the absolute
 value of 
\begin_inset Formula $R_{l}^{a}[2,1]$
\end_inset

 is smaller than 
\begin_inset Formula $R_{l}^{a}[1,1]/10$
\end_inset

.
\end_layout

\begin_layout Section
Discussion of the 
\begin_inset Quotes eld
\end_inset

Tests of the derivatives
\begin_inset Quotes erd
\end_inset

 section
\end_layout

\begin_layout Standard
An important part of the work that is background to this section was determining
 the time shifts to apply to various measurements from the INS.
 The 
\begin_inset Quotes eld
\end_inset

initialization
\begin_inset Quotes erd
\end_inset

 chunk of R code applies these time shifts, using the 
\begin_inset Quotes eld
\end_inset

Ranadu::ShiftInTime()
\begin_inset Quotes erd
\end_inset

 function.
 The time shifts quoted in the text were determined by varying the shifts
 specified in that section and observing the result by plotting the plot
 generated in the 
\begin_inset Quotes eld
\end_inset

plot-acc
\begin_inset Quotes erd
\end_inset

 chunk but modified to display only the pitch maneuver (3::16:00 to 3:18:00)
 and observing the difference between the measured values and the values
 determined from the derivatives of the velocity measurements.
 This was not done systematically but rather by trial-and-error to find
 a combination of time shifts that showed small fluctuations during the
 maneuver.
 These results are sensitive to pitch and roll as well because, in the case
 of pitch, gravity is resolved into a longitudinal component of acceleration
 that affects the comparison to BLONGA, and in the case of roll small roll
 angles created similar contributions to the lateral acceleration represented
 by BLATA.
 In the exploration of time shifts, the measured accelerations were assumed
 to have the same time delays, and similar assumptions were made about the
 pitch-roll pair and the set of velocities.
 With the listed shifts, the residual errors (shown in Tables 1 and 2) were
 so small that further refinement did not seem warranted.
\end_layout

\begin_layout Standard
Not discussed here are the small differences that persisted in the circle
 maneuvers.
 These were very small in magnitude (
\begin_inset Formula $<0.05$
\end_inset


\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

) but nevertheless systematic and correctable.
 For example, the difference between lateral acceleration components measured
 by the INS and deduced by differentiating the GPS signals needs the approximate
 correction term,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\delta a_{lat}=0.43\,\dot{\psi}(1+\sin\psi)
\]

\end_inset

which has typical magnitude in the range (0–0.03
\begin_inset space ~
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

.
 The difference between the acceleration at the location of the GPS antenna
 and that at the INS, if they are separated by 
\begin_inset Formula $L\approx4.3$
\end_inset


\begin_inset space ~
\end_inset

m along the longitudinal axis of the aircraft, would be expected to be
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\delta a_{long}=\dot{\psi}^{2}L
\]

\end_inset

and the typical values in the turn are 
\begin_inset Formula $\dot{\psi}=0.035$
\end_inset

, so the expected magnitude of this centripetal acceleration would be about
 0.005
\begin_inset space ~
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

, smaller than needed to account for these errors.
 If there is also a rotation 
\begin_inset Formula $\dot{\theta}$
\end_inset

 about the pitch axis, there would be a similar contribution from that rotation,
 but the typical magnidute of 
\begin_inset Formula $\dot{\theta}$
\end_inset

 is only about 0.001, so this contribution is yet smaller.
 No explanation for these small perturbations has been found, and they appear
 only in prolonged turns.
 
\end_layout

\begin_layout Section
Discussion of the 
\begin_inset Quotes eld
\end_inset

Mechanization
\begin_inset Quotes erd
\end_inset

 section
\end_layout

\begin_layout Standard
The following box contains an algorithmic flow chart describing the mechanizatio
n scheme:
\end_layout

\begin_layout LyX-Code
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout LyX-Code
Initialize the aircraft-state vector sv;
\end_layout

\begin_deeper
\begin_layout LyX-Code
## three position coordinates, three velocity coordinates, three attitude-angle
 coordinates #
\end_layout

\end_deeper
\begin_layout LyX-Code
Read and save the IRU measurements M (accelerations and rotation rates)
 vs.
 time;
\end_layout

\begin_layout LyX-Code
Construct a function (STMFV(sv,M)) that returns a derivative vector;
\end_layout

\begin_deeper
\begin_layout LyX-Code
## each element STMFV
\begin_inset Formula $_{i}$
\end_inset

 is the derivative of sv
\begin_inset Formula $_{i}$
\end_inset

 with respect to time, given M #
\end_layout

\end_deeper
\begin_layout LyX-Code
For each measurement time (index i) in the data set, at intervals 
\begin_inset Formula $\Delta$
\end_inset

t:
\end_layout

\begin_deeper
\begin_layout LyX-Code
Use STMFV (sv[i], M[i]) to find the derivative vector (D[i]);
\end_layout

\begin_layout LyX-Code
Propagate the state vector forward one time step, via sv[i+1]
\begin_inset Formula $\leftarrow$
\end_inset

sv[i]+D[i]
\begin_inset Formula $\Delta$
\end_inset

t;
\end_layout

\begin_layout LyX-Code
Save the resulting state vector sv[i+1];
\end_layout

\end_deeper
\end_inset


\end_layout

\begin_layout Standard
The core of the mechanization is the function STMFV().
 Various references have provided 
\begin_inset Quotes eld
\end_inset

cookbook
\begin_inset Quotes erd
\end_inset

 equations for the required derivatives.
 In particular, the approach followed was that described by 
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

, but with some differences arising primarily from use of the aircraft-coordinat
e frame or 
\emph on
a-
\emph default
frame instead of the 
\emph on
b-
\emph default
frame (body frame) used in that source.
 In addition, the derivatives of the attitude-angle components were calculated
 differently, so some detail regarding this function is approproate.
\end_layout

\begin_layout Subsection
The derivative function STMFV()
\end_layout

\begin_layout Standard
As coded, STMFV (sv) assumes that the measurements from the IRU (accelerations
 and rotation rates) have been added to the aircraft-state vector 
\begin_inset Quotes eld
\end_inset

sv
\begin_inset Quotes erd
\end_inset

 for convenience.
 The function provides a unique-time representation of the derivative matrix
 and is not vectorized like most R code.
 The function has a second argument, 
\begin_inset Quotes eld
\end_inset

.aaframe
\begin_inset Quotes erd
\end_inset

, but by default this is set to 
\begin_inset Quotes eld
\end_inset

a
\begin_inset Quotes erd
\end_inset

 and in that form provides derivatives for the attitude angles in the 
\begin_inset Quotes eld
\end_inset

a
\begin_inset Quotes erd
\end_inset

 frame.
 If that argument is set to 
\begin_inset Quotes eld
\end_inset

l
\begin_inset Quotes erd
\end_inset

, the derivatives for attitude angles are provided in the 
\emph on
l-
\emph default
frame instead.
 This is used later in the error-state Kalman filter, but not in the initial
 mechanization.
\end_layout

\begin_layout Enumerate
The position state variables are latitude, longitude, and altitude.
 Their derivatives are related to the velocity state variable as follows
 (cf.
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
after "pages 47--48 and 175"
key "noureldin2013fundamentals"

\end_inset

):
\end_layout

\begin_deeper
\begin_layout Enumerate
\begin_inset Formula $d\lambda/dt=v_{n}/(R_{m}+z)$
\end_inset

 where 
\begin_inset Formula $\lambda$
\end_inset

 is the latitude, 
\begin_inset Formula $v_{n}$
\end_inset

 is the northward ground speed of the aircraft, 
\begin_inset Formula $z$
\end_inset

 the altitude, and 
\begin_inset Formula $R_{m}$
\end_inset

 the radius of the Earth about a meridional circle, taken to be
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
R_{m}=R_{e}\frac{(1-\epsilon^{2})}{(1-\epsilon^{2}\sin^{2}\lambda)^{3/2}}
\]

\end_inset

with the equatorial radius 
\begin_inset Formula $R_{e}=6378137\,$
\end_inset

m and the Earth's eccentricity 
\begin_inset Formula $\epsilon=0.08181919.$
\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $d\Psi/dt=v_{e}/((R_{n}+z)\cos\lambda)$
\end_inset

 where 
\begin_inset Formula $\Psi$
\end_inset

 is the longitude, 
\begin_inset Formula $v_{e}$
\end_inset

 is the eastward ground speed of the aircraft, and 
\begin_inset Formula $R_{n}$
\end_inset

 the normal radius of the Earth's ellipsoid, taken to be
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
R_{n}=R_{e}\frac{1}{(1-\epsilon^{2}\sin^{2}\lambda)^{1/2}}\,\,\,\,\,.
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $dz/dt=v_{u}$
\end_inset

 where 
\begin_inset Formula $v_{u}$
\end_inset

 is the vertical component of the aircraft motion.
\end_layout

\end_deeper
\begin_layout Enumerate
The velocity components (
\begin_inset Formula $v_{n},\,v_{e},\,v_{u}$
\end_inset

) have derivatives related to the measured accelerations.
 These accelerations are measured in the 
\emph on
a-
\emph default
frame but the velocity components are those in the 
\emph on
l-
\emph default
frame, so the measurements must be transformed between reference frames.
 In addition, corrections must be made for accelerations arising from Coriolis
 effects and rotations of the 
\emph on
l-
\emph default
frame
\emph on
 
\emph default
relative to an inertial frame.
 The procedure is as follows:
\end_layout

\begin_deeper
\begin_layout Enumerate
A function xfLArv(sv), modeled on XformLA() discussed above, returns a matrix
 in the R variable 
\family typewriter
rlm 
\family default
giving the transformation from the 
\emph on
a-
\emph default
frame to the 
\emph on
l-
\emph default
frame for the supplied aircraft-state vector, which has attitude angles
 specified in radians rather than degrees as in XformLA().
 The returned matrix matches the definition for 
\begin_inset Formula $R_{a}^{l}$
\end_inset

 in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:XformLA"

\end_inset

).
\end_layout

\begin_layout Enumerate
The measured accelerations are placed in a three-component vector 
\begin_inset Formula $\boldsymbol{\dot{v}}^{(a)}$
\end_inset

, the acceleration of gravity is added to the normal component (because
 by convention that component is reported after subtraction of the acceleration
 of gravity), the transformation matrix is used to transform the accelerations
 to the 
\emph on
l-
\emph default
frame, and the acceleration of gravity is subtracted from the third component
 again: 
\begin_inset Formula $\dot{\boldsymbol{v}}^{(l)}=\boldsymbol{R}_{a}^{l}\dot{\boldsymbol{v}}^{(a)}$
\end_inset

.
 
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

 [cf.
\begin_inset space ~
\end_inset

pp.
\begin_inset space ~
\end_inset

178–179] give the correction 
\begin_inset Formula $\Delta\dot{\boldsymbol{v}}$
\end_inset

 to be added to the 
\begin_inset Formula $l$
\end_inset

-frame acceleration to account for the Coriolis accelerations and the rotation
 of the 
\emph on
l-
\emph default
frame relative to an inertial frame as the aircraft moves:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\mathbf{\Delta\boldsymbol{\dot{\mathbf{v}}}=}-(2\boldsymbol{\Omega}_{ie}^{l}+\boldsymbol{\Omega}_{el}^{l})\mathbf{v}^{(l)}\label{eq:rotation-correction}
\end{equation}

\end_inset

where the rotation matrices, respectively representing the Earth's rotation
 and the 
\begin_inset Formula $l$
\end_inset

-frame rotation, are
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{\Omega}_{ie}^{l}=\left[\begin{array}{ccc}
0 & -\omega^{e}\sin\lambda & \omega^{e}\cos\lambda\\
\omega^{e}\sin\lambda & 0 & 0\\
-\omega^{e}\cos\lambda & 0 & 0
\end{array}\right]\label{eq:first-omega-eq}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{\Omega}_{el}^{l}=\left[\begin{array}{ccc}
0 & \frac{-v_{e}\tan\lambda}{R_{N}+z} & \frac{v_{e}}{R_{N}+z}\\
\frac{v_{e}\tan\lambda}{R_{N}+z} & 0 & \frac{v_{n}}{R_{M}+z}\\
\frac{-v_{e}}{R_{N}+z} & \frac{-v_{n}}{R_{M}+z} & 0
\end{array}\right]\label{eq:second-omega-equation}
\end{equation}

\end_inset

with 
\begin_inset Formula $\omega^{e}=7.292\times10^{-5}$
\end_inset

 the angular rate of rotation of the Earth.
 
\end_layout

\begin_layout Enumerate
Evaluation of the typical magnitudes arising from the rotation terms indicates
 that the components in 
\begin_inset Formula $\Delta\dot{\boldsymbol{v}}$
\end_inset

 are of minor but not negligible significance, so this correction is added
 to the 
\begin_inset Formula $l$
\end_inset

-frame accelerations.
 The result is the vector acceleration in the 
\emph on
l-
\emph default
frame and hence the three derivatives of the velocity components in the
 aircraft-state vector.
\end_layout

\begin_layout Enumerate
Without some feedback, the vertical component is unstable, so the INS uses
 feedback based on the pressure altitude to control the third component
 of aircraft velocity.
 To obtain an analogous variable for comparison, a feedback loop was used
 for the third component arising from this new mechanization.
 A conventional feedback loop uses three coefficients specified in terms
 of a parameter 
\begin_inset Formula $\zeta$
\end_inset

 as {
\begin_inset Formula $C_{0},\,C_{1},\,C_{2})=\{3$
\end_inset


\begin_inset Formula $\zeta$
\end_inset

, 4
\begin_inset Formula $\zeta^{2}$
\end_inset

, 2
\begin_inset Formula $\zeta^{3}$
\end_inset

).
 In an attempt to duplicate the INS reference source, the reference altitude
 was calculated as the pressure altitude corresponding to the avionics-supplied
 value of the pressure, but this still gave a small offset from the INS
 values so a slightly different pressure source must be used by the INS.
 The loop was implemented in the conventional way according to the algorithm
 in the next box:
\begin_inset Newline newline
\end_inset


\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout

\family typewriter
initialize:
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

wp3F=0; hxF=0; hxxF=0; hi3F=PALT[1];
\end_layout

\begin_layout Plain Layout
for each ith time step of time change dt:
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

wp3F += (sv[6] - C1*hxF - C2*hxxF) * dt; ## sv is the state vector; sv[6]
 is vertical speed
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

hi3F += (wp3F - C0*hxF) * dt;
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

hxF = HI3F-PALT[i];
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

hxxF += hxF*dt;
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

sv[6] = (sv[6] + wp3F)/2;
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

sv[3] = hi3F; ## sv[3] is then the altitude of the aircraft
\end_layout

\begin_layout Plain Layout
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

[save sv[3] and sv[6] as the values of the aircraft-state vector vs time]
\end_layout

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
The attitude angles are handled differently.
 The change in the transformation matrix 
\begin_inset Formula $\boldsymbol{R}_{a}^{l}$
\end_inset

 is related to the measured rotation rates (
\begin_inset Formula $\dot{\theta},$
\end_inset


\begin_inset Formula $\dot{\phi},$
\end_inset

 
\begin_inset Formula $\dot{\Psi}$
\end_inset

)=(BPITCHR, BROLLR, 
\begin_inset Formula $-$
\end_inset

BYAWR), again with a rotation correction for inertial effects.
 The steps are as follows:
\end_layout

\begin_deeper
\begin_layout Enumerate
The measured rotation rates are represented for convenience in a skew-symmetric
 matrix of the form
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\Omega_{ia}^{a}=\left[\begin{array}{ccc}
0 & -\dot{\Psi} & -\dot{\theta}\\
\dot{\Psi} & 0 & \dot{\phi}\\
\dot{\theta} & -\dot{\phi} & 0
\end{array}\right]
\]

\end_inset

so that matrix multiplication 
\begin_inset Formula $\boldsymbol{R}_{a}^{l}\Omega_{ia}^{a}$
\end_inset

gives the first term in the derivative of 
\begin_inset Formula $\boldsymbol{R}_{a}^{l}$
\end_inset

.
\end_layout

\begin_layout Enumerate
The required correction for inertial effects can be written 
\begin_inset Formula $-\Omega_{il}^{a}\boldsymbol{R}_{a}^{l}$
\end_inset

 where, if 
\begin_inset Formula $\omega$
\end_inset

 is defined as
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\omega=\left[\begin{array}{c}
-v_{e}/(R_{M}+z)\\
\Omega_{E}\cos\lambda+(v_{n}/(R_{n}+z))\\
\Omega_{E}\sin\lambda+(v_{n}\tan\lambda/(R_{N}+z))
\end{array}\right]
\]

\end_inset

with 
\begin_inset Formula $\Omega_{E}$
\end_inset

 the angular rotation rate of the Earth, 
\begin_inset Formula $\Omega_{il}^{l}$
\end_inset

 is the skew-symmetric representation of 
\begin_inset Formula $\omega:$
\end_inset

 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\Omega_{il}^{l}=\left[\begin{array}{ccc}
0 & -\omega_{3} & \omega_{2}\\
\omega_{3} & 0 & -\omega_{1}\\
-\omega_{2} & \omega_{1} & 0
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
The combination of the above two effects gives the derivative of the transformat
ion matrix, 
\begin_inset Formula $\dot{\boldsymbol{R}_{a}^{l}}=\mathbf{R}_{a}^{l}\mathbf{\Omega}_{ia}^{a}+\mathbf{\Omega}_{il}^{l}\mathbf{R}_{a}^{l}$
\end_inset

.
 The change in the attitude angles can then be found by using (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:XformLA"

\end_inset

) to derive these relationships between the transformation matrix and the
 attitude angles:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{eqnarray*}
\theta & = & \arcsin(-R_{l}^{a}[3,1])\\
\phi & = & \arctan2(R_{l}^{a}[3,2],\,-R_{l}^{a}[3,3])\\
\Psi & = & \arctan2(R_{l}^{a}[1,1],\,R_{l}^{a}[1,2])
\end{eqnarray*}

\end_inset

The derivatives of the attitude angles are then given by the derivatives
 of the arcsin and arctan functions:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{eqnarray*}
\frac{d(\arcsin(x))}{dx} & = & \frac{1}{\sqrt{1-x^{2}}}\\
\frac{d(\arctan(x))}{dx} & = & \frac{1}{1+x^{2}}\\
\dot{\theta} & = & \frac{-1}{\sqrt{1-R_{l}^{a}[3,1]^{2}}}\dot{R}_{l}^{a}[3,1]\\
\dot{\phi} & = & \frac{1}{1+\left(R_{l}^{a}[3,2]/R_{l}^{a}[3.3]\right)^{2}}\frac{R_{l}^{a}[3,2]}{R_{l}^{a}[3,3]}\left(\frac{\dot{R}_{l}^{a}[3,3]}{R_{l}^{a}[3,3]}-\frac{\dot{R}_{l}^{a}[3,2]}{R_{l}^{a}[3,2]}\right)\\
\dot{\psi} & = & \frac{1}{1+\left(R_{l}^{a}[1,1]/R_{l}^{a}[1,2]\right)^{2}}\frac{R_{l}^{a}[1,1]}{R_{l}^{a}[1,2]}\left(\frac{\dot{R}_{l}^{a}[1,1]}{R_{l}^{a}[1,1]}-\frac{\dot{R}_{l}^{a}[1,2]}{R_{l}^{a}[1,2]}\right)\\
 & = & \frac{1}{1+\left(R_{l}^{a}[1,1]/R_{l}^{a}[1,2]\right)^{2}}\left(\frac{\dot{R}_{l}^{a}[1,1]}{R_{l}^{a}[1,2]}-\frac{\dot{R}_{l}^{a}[1,2]R_{l}^{a}[1,1]}{R_{l}^{a}[1,2]^{2}}\right)
\end{eqnarray*}

\end_inset

Because 
\begin_inset Formula $R_{l}^{1}[1,2]$
\end_inset

 (equal to 
\begin_inset Formula $\cos\psi\cos\theta$
\end_inset

) can pass through zero for heading of 90 or 270
\begin_inset Formula $^{\circ},$
\end_inset

 some numerical problems arise when the last equation is used.
 (Avoiding similar problems at the zero for 
\begin_inset Formula $R_{l}^{a}[1,1]$
\end_inset

 is the justification for using the second form of the last equation.) For
 small 
\begin_inset Formula $R_{l}^{a}[1,2]$
\end_inset

, the last equation becomes
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\dot{\psi}=\left(\frac{R_{l}^{a}[1,2]\dot{R}_{l}^{a}[1,1]}{R_{l}^{a}[1,1]^{2}}-\frac{\dot{R}_{l}^{a}[1,2]}{R_{l}^{a}[1,1]}\right)
\]

\end_inset

which avoids the singularity, so this form will be used when the absolute
 value of 
\begin_inset Formula $R_{l}^{a}[1,2]$
\end_inset

 is smaller than 0.001.
\begin_inset Newline newline
\end_inset


\end_layout

\end_deeper
\begin_layout Subsection
The integration loop
\end_layout

\begin_layout Standard
Before the step-wise integration, some adjustments were made to the measurements.
 To ensure against missing values, interpolation was used to fill in a very
 small number of missing values in the measurements from the IRU.
 In addition, some of the measurements were shifted in time to compensate
 for delays in recording of the variables.
 This shifting is a part of normal processing, but the mechanization is
 very sensitive to timing errors so some fine tuning was used.
 The procedure was discussed in connection with the Ranadu::ShiftInTime()
 function discussed above.
 In addition, a few errors in interpolation were introduced to the heading
 variable by this process, so a special loop searched for these errors (four
 in the data set used) and corrected them.
 The problem arose from a deficiency in the ShiftInTime() function that
 still needs to be corrected.
\end_layout

\begin_layout Standard
After initializing the aircraft-state vector to match that from the INS
 at a point near the start of the flight, the mechanization proceeded by
 taking time steps where the changes in the aircraft-state vector were determine
d by the preceding derivative function.
 The KalmanFilter.pdf report describes the initialization and the sequence
 of time steps.
 For convenience, the measurements of acceleration and rotation rate from
 the IRU were added to the state vector with each time step so that those
 measurements were transferred to the function STMFV(sv) when it is called.
 The integration was done either by simple Euler integration or via a fourth
 order Runge-Kutta scheme, with indistinguishable results.
 A special step was used to ensure that the heading remained in the range
 from 0 to 
\begin_inset Formula $2\pi$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Treatment of the pitch and roll angles
\end_layout

\begin_layout Standard
The report lists the transformation used between 
\emph on
a-
\emph default
frame and 
\emph on
l-
\emph default
frame angles, as Equations (3–6).
 Justification for those equations is provided here.
\end_layout

\begin_layout Standard
In the 
\emph on
a-
\emph default
frame where pitch and roll are measured, the roll angle is defined as the
 reverse of the rotation about the 
\emph on
a-
\emph default
frame forward axis required to level the wings, and the pitch angle is the
 reverse of the subsequent rotation about the starboard axis required to
 level the fuselage.
 The 
\emph on
l-
\emph default
frame error in pitch is defined to be the platform misalignment with tilt
 to the south 
\bar under
after the roll error is removed
\bar default
,, while the 
\emph on
l-
\emph default
frame error in roll is the component of platform misalignment toward the
 east.
 If the 
\emph on
l-
\emph default
frame errors are known, one can find the 
\emph on
a-
\emph default
frame errors by considering a unit vector normal to the sensed platform
 alignment in the upward 
\emph on
l-
\emph default
frame direction with the components that would result from rotating a unit
 vector that points in the 
\emph on
l-
\emph default
frame 
\emph on
z
\emph default
 direction by the pitch error (
\begin_inset Formula $\delta\theta{}^{(l)})$
\end_inset

 about the x-axis and then by the roll error (
\begin_inset Formula $\delta\phi^{(l)}$
\end_inset

) about the y-axis.
 The result of these two rotations is
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\boldsymbol{u}^{(l)}=\begin{bmatrix}\cos(\delta\phi^{(l)}) & 0 & \sin(\delta\phi^{(l)})\\
0 & 1 & 0\\
-\sin(\delta\phi^{(l)}) & 0 & \cos(\delta\phi^{(l)})
\end{bmatrix}\begin{bmatrix}1 & 0 & 0\\
0 & \cos(\delta\theta^{(l)}) & -\sin(\delta\theta^{(l)})\\
0 & \sin(\delta\theta^{(l)}) & \cos(\delta\theta^{(l)})
\end{bmatrix}\begin{bmatrix}0\\
0\\
1
\end{bmatrix}=\left[\begin{array}{c}
\sin(\delta\phi^{(l)})\cos(\delta\theta^{(l)})\\
-\sin(\delta\theta^{(l)})\\
\cos(\delta\theta^{(l)})\cos(\delta\phi^{(l)})
\end{array}\right]\simeq\begin{bmatrix}\delta\phi^{(l)}\\
-\delta\theta^{(l)}\\
1
\end{bmatrix}
\]

\end_inset

Transformed to the 
\emph on
a-
\emph default
frame via the inverse of (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:XformLA"

\end_inset

), this unit vector becomes
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\boldsymbol{u}^{(a)}=(R_{l}^{a})^{\intercal}\boldsymbol{u}^{(l)}=\begin{bmatrix}\sin\psi\cos\theta\thinspace\delta\phi^{(l)}-\cos\psi\cos\theta\thinspace\delta\theta^{(l)}-\sin\theta\\
(\sin\psi\sin\theta\sin\phi+\cos\psi\cos\phi)\thinspace\delta\phi^{(l)}-(\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi)\thinspace\delta\theta^{(l)}+\cos\theta\sin\phi\\
(\cos\psi\sin\phi-\sin\psi\sin\theta\cos\phi)\thinspace\delta\phi^{(l)}+(\cos\psi\sin\theta\cos\phi+\sin\psi\sin\phi)\thinspace\delta\theta^{(l)}-\cos\theta\cos\phi
\end{bmatrix}
\]

\end_inset

The difference between this unit vector and the corresponding unit vector
 obtained without any errors in pitch and roll is then
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\delta\boldsymbol{u}^{(a)}=\begin{bmatrix}-\cos\psi\cos\theta\thinspace\delta\theta^{(l)}+\sin\psi\cos\theta\thinspace\delta\phi^{(l)}\\
-(\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi)\thinspace\delta\theta^{(l)}+(\sin\psi\sin\theta\sin\phi+\cos\psi\cos\phi)\thinspace\delta\phi^{(l)}\\
(\cos\psi\sin\theta\cos\phi+\sin\psi\sin\phi)\thinspace\delta\theta^{(l)}+(\cos\psi\sin\phi-\sin\psi\sin\theta\cos\phi)\thinspace\delta\phi^{(l)}
\end{bmatrix}
\]

\end_inset

In the 
\emph on
a-
\emph default
frame, the error in pitch is 
\begin_inset Formula $\delta\theta^{(a)}\simeq-\delta u_{x}^{(a)}$
\end_inset

 and the error in roll is 
\begin_inset Formula $\delta\phi^{(a)}=\delta u_{y}^{(a)}$
\end_inset

, so the transformation of errors from the 
\emph on
l-
\emph default
frame to the 
\emph on
a-
\emph default
frame is
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{eqnarray}
\delta\theta^{(a)} & = & \cos\psi\cos\theta\thinspace\delta\theta^{(l)}-\sin\psi\cos\theta\thinspace\delta\phi^{(l)}\simeq\cos\psi\thinspace\delta\theta^{(l)}-\sin\psi\thinspace\delta\phi^{(l)}\nonumber \\
\delta\phi^{(a)} & = & -(\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi)\thinspace\delta\theta^{(l)}+(\sin\psi\sin\theta\sin\phi+\cos\psi\cos\phi)\thinspace\delta\phi^{(l)}\label{eq:errors-in-a-frame}\\
 & \simeq & \cos\phi(\sin\psi\,\delta\theta^{(l)}+\cos\psi\thinspace\delta\phi^{(l)})\nonumber 
\end{eqnarray}

\end_inset

where the approximations are that 
\begin_inset Formula $\cos\theta\simeq1$
\end_inset

 and 
\begin_inset Formula $\sin\theta\simeq0$
\end_inset

, which are reasonable because the pitch angle seldom exceeds a few degrees.
 A similar approximation cannot be made for roll because the roll becomes
 significant in turns where the factor 
\begin_inset Formula $\cos\phi$
\end_inset

 in the last equation becomes an important factor.
\end_layout

\begin_layout Standard
Equations (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:errors-in-a-frame"

\end_inset

), without the approximations, were code in the function XPitch().
 That function also had an argument .inverse that, when true, calculated
 to reverse transformation from the 
\emph on
a-
\emph default
frame to the 
\emph on
l-
\emph default
frame, obtained from the inverse of (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:errors-in-a-frame"

\end_inset

):
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\delta\theta^{(l)}=\frac{1}{\cos\theta\cos\phi}\left[(\sin\psi\sin\theta\sin\phi+\cos\psi\cos\phi)\,\delta\theta^{(a)}+\sin\psi\cos\theta\thinspace\delta\phi^{(a)}\right]
\]

\end_inset


\begin_inset Formula 
\begin{eqnarray*}
\delta\phi^{(l)} & = & \frac{1}{\cos\theta\cos\phi}\left[(\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi)\thinspace\delta\theta^{(a)}+\cos\psi\cos\theta\thinspace\delta\phi^{(l)}\right]
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
xxx
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
from 
\begin_inset Formula $\delta\theta^{(l)}=\arcsin(y_{u}^{(l)}/z_{u}^{(l)})$
\end_inset

 and 
\begin_inset Formula $\delta\phi^{(l)}=\arcsin(x_{u}^{(l)}/z_{u}^{(l)})$
\end_inset

These are then the 
\emph on
a-
\emph default
frame coordinates of a unit vector in the direction of the misaligned platform
 
\emph on
z 
\emph default
axis.
 In the 
\emph on
l-
\emph default
frame, the pitch error is the angle given by and the roll error must satisfy
 
\begin_inset Formula $ $
\end_inset

.
 with 
\begin_inset Formula $\sin(y_{u}/z_{u})$
\end_inset


\emph on
 
\emph default
Consider a unit vector in the 
\emph on
a-
\emph default
frame that points in the sensed direction of the z-axis
\emph on
 
\emph default
(usually approximately downward) but with components 
\begin_inset Formula $x_{u}$
\end_inset

 and 
\begin_inset Formula $y_{u}$
\end_inset

 representing the alignment errors, with 
\begin_inset Formula $z_{u}=\sqrt{1-x_{u}^{2}-y_{u}^{2}}$
\end_inset

 the third component of the unit vector.
 In terms of the a-frame errors in pitch and roll (
\begin_inset Formula $\delta\theta$
\end_inset

 and 
\begin_inset Formula $\delta\phi$
\end_inset

), 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
x_{u}=-\sin(\delta\theta)\cos(\delta\phi)
\]

\end_inset


\begin_inset Formula 
\[
y_{u}=-\sin(\delta\phi)
\]

\end_inset

as would result from rotation a unit vector along the 
\emph on
z-
\emph default
axis first about the roll axis by 
\begin_inset Formula $\delta\phi$
\end_inset

 and then about the pitch axis by 
\begin_inset Formula $\delta\theta$
\end_inset

.
 
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Subsection
Results
\end_layout

\begin_layout Standard
The plots of results shown in the subsection of the KalmanFilterTechNote.pdf
 report named 
\begin_inset Quotes eld
\end_inset

Mechanization using the derivatives
\begin_inset Quotes erd
\end_inset

 were generated using the 
\begin_inset Quotes eld
\end_inset

Ranadu::ggplotWAC()
\begin_inset Quotes erd
\end_inset

 convenience function, which calls functions that are part of ggplot2 with
 some assigned settings.
 During the mechanization, the aircraft-state vector was saved in variables
 in an R data.frame called SP, and at the end these variables were added
 back to the original data.frame (called Data) as new variables with names
 like LATX, LONX, ALTX, ...
 that correspond to the original INS-produced variables LAT, LON, ALT.
 These variables were then used in plot commands to generate the figures
 in the subsections that compare the results for attitude angles, velocity
 components, and position.
\end_layout

\begin_layout Standard
Many of the plots were generated in multiple-panel displays.
 This was straightforward in standard R graphics, using the 
\begin_inset Quotes eld
\end_inset

layout()
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

par()
\begin_inset Quotes erd
\end_inset

 functions, and was used in first drafts.
 However, plotting with ggplot2 produced plots with better appearance.
 This was tried in two ways, first using viewports and then using facets.
 With viewports, it was difficult to get the panels to align vertically
 without much tailoring of margins, but facets handled this automatically
 so that was the method in the final version.
 The procedure is worth documenting here because it took some exploration.
 This was built into a revision of the function 
\begin_inset Quotes eld
\end_inset

Ranadu::ggplotWAC(),
\begin_inset Quotes erd
\end_inset

 which is used as follows:
\end_layout

\begin_layout Enumerate
Construct a new data.frame that contains only the variables that will appear
 on the plot, along with the 
\begin_inset Quotes eld
\end_inset

Time
\begin_inset Quotes erd
\end_inset

 variable (which should be first).
 Variables should be in lines/panel format, i.e., all variables for the top
 panel, all for the next-to-top, etc.
 
\end_layout

\begin_layout Enumerate
Call ggplotWAC() with these new arguments: 
\end_layout

\begin_deeper
\begin_layout Enumerate
panels: the number of panels or facets, aligned vertically
\end_layout

\begin_layout Enumerate
lines_per_panel: the number of variables per panel.
 
\end_layout

\begin_layout Enumerate
labelL: the names to appear in the legend for the lines.
 Only one legend appears for all panels.
\end_layout

\begin_layout Enumerate
labelP: the names to appear in side strips for each panel.
\end_layout

\end_deeper
\begin_layout Enumerate
The procedure that ggplotWAC() uses is as follows:
\end_layout

\begin_deeper
\begin_layout Enumerate
Define two groups, VarGroup and PanelGroup, to describe the structure specified
 by the new arguments.
\end_layout

\begin_layout Enumerate
\begin_inset Quotes eld
\end_inset

melt
\begin_inset Quotes erd
\end_inset

 the data.frame to a long-format data.frame, with 
\begin_inset Quotes eld
\end_inset

Time
\begin_inset Quotes erd
\end_inset

 as the id.var, and include the two new groups in the data.frame definition.
\end_layout

\begin_layout Enumerate
Use the ggplotWAC() arguments for cols, lwd, and lty in groups for each
 panel, with replication as needed.
 Each panel must be the same.
 
\end_layout

\begin_layout Enumerate
Construct the initial plot definition using ggplot, using x=Time, y=value,
 colour=VarGroup, linetype=VarGroup in the aesthetic specification.
 
\end_layout

\begin_layout Enumerate
Add 
\begin_inset Quotes eld
\end_inset

geom_line(aes(size=VarGroup))
\begin_inset Quotes erd
\end_inset

 to this definition.
\end_layout

\begin_layout Enumerate
Use appropriate manual scale definitions to set the desired colors, line
 types, and line widths in order to get consistent plot lines and legend.
\end_layout

\begin_layout Enumerate
Add 
\begin_inset Quotes eld
\end_inset

facet_grid()
\begin_inset Quotes erd
\end_inset

 with first argument 
\begin_inset Quotes eld
\end_inset

PanelGroup
\begin_inset Quotes erd
\end_inset

 as included in the data.frame definition.
\end_layout

\begin_layout Enumerate
Tailor desired aspects of the plotting theme.
\end_layout

\end_deeper
\begin_layout Standard
The routine then returns a plot definition, and that definition can be tailored
 further using 
\begin_inset Quotes eld
\end_inset

theme()
\begin_inset Quotes erd
\end_inset

 elements if desired or printed without further modification.
\end_layout

\begin_layout Standard
Here is the code for the plot of attitude angles:
\end_layout

\begin_layout LyX-Code
d <- with(Data[setRange(Data, 32000, 35500), ], 
\end_layout

\begin_layout LyX-Code
          data.frame(Time, PITCH, PITCHX, DPITCH, ROLL, ROLLX, DROLL,
\end_layout

\begin_layout LyX-Code
                     THDG, THDGX, DTHDG))
\end_layout

\begin_layout LyX-Code
ggplotWAC (d, col=c('blue', 'red', 'forestgreen'), 
\end_layout

\begin_layout LyX-Code
          ylab=expression (paste ('attitude angles [', degree, ']')),
\end_layout

\begin_layout LyX-Code
          lwd=c(1.4, 0.8, 1), lty=c(1, 42, 1), panels=3, lines_per_panel=3,
\end_layout

\begin_layout LyX-Code
          labelL=c('original', 'new', 'diff'),
\end_layout

\begin_layout LyX-Code
          labelP=c('pitch', 'roll', 'heading'),
\end_layout

\begin_layout LyX-Code
          legend.position=c(0.8, 0.97))
\end_layout

\begin_layout Standard
The subsection on 
\begin_inset Quotes eld
\end_inset

Velocity
\begin_inset Quotes erd
\end_inset

 cites a calibration of two components of the acceleration provided by the
 IRU, obtained by comparing the acceleration obtained by differentiating
 the GPS-provided measurements of velocity to the measured accelerations.
 This comparison is contained in the R-code chunk named 
\begin_inset Quotes eld
\end_inset

acceleration-check
\begin_inset Quotes erd
\end_inset

.
 The details are as follows:
\end_layout

\begin_layout Enumerate
Differentiate the GPS-provided velocity components (GGVEW, GGVNS, GGVSPD)
 via the R routine signal::sgolayfilt() with appropriate argument that returns
 the first derivative of the filtered function.
 Cubic Savitzky-Golay polynomials spanning 11 25-Hz measurements were used,
 which effectively imposes a high-pass cutoff of about 8
\begin_inset space ~
\end_inset

Hz and so applies only minor smoothing while retaining high temporal resolution
 in the derivatives.
 
\end_layout

\begin_layout Enumerate
An appropriate rotation correction as discussed in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:rotation-correction"

\end_inset

) above, but with reversed sign, is applied to these accelerations.
\end_layout

\begin_layout Enumerate
The resulting accelerations are then transformed to the 
\emph on
a-
\emph default
frame using the same function XformLA() discussed above but with the argument
 
\begin_inset Quotes eld
\end_inset

.inverse
\begin_inset Quotes erd
\end_inset

 set TRUE to give the transformation from the 
\emph on
l-
\emph default
frame to the 
\emph on
a-
\emph default
frame instead.
\end_layout

\begin_layout Enumerate
The R routine 
\begin_inset Quotes eld
\end_inset

lm()
\begin_inset Quotes erd
\end_inset

 then gives the linear-model fit relating the IRU-measured accelerations
 to the GPX-derived accelerations.
 The coefficients from that fit are those quoted in the document.
\end_layout

\begin_layout Enumerate
One subtle circularity needs mention here: The coefficients obtained are
 obtained from the original measurements as stored in the data.frame Data,
 but the resulting calibration was already applied earlier and saved in
 the data.frame SP that is used for the mechanization loop.
 These calibrations were inserted manually into the statements near the
 end of R-code chunk 
\begin_inset Quotes eld
\end_inset

INS-data
\begin_inset Quotes erd
\end_inset

, in the section following the comment 
\begin_inset Quotes eld
\end_inset

adjustments
\begin_inset Quotes erd
\end_inset

.
 As mentioned in the main report, no calibration was applied to the measurements
 
\begin_inset Quotes eld
\end_inset

BLATA
\begin_inset Quotes erd
\end_inset

 because the IRU-provided and GPS-derived lateral accelerations were consistentl
y small and the calibration did not appear sufficiently reliable to trust,
 especially because the result was significantly different from the identity
 calibration that reasonably characterized the other two components of measured
 acceleration.
\end_layout

\begin_layout Section
Retrieving the IRU measurements
\end_layout

\begin_layout Standard
The rotation rates and accelerations measured by the IRU {BPITCHR, BROLLR,
 BYAWR, BLATA, BLONGA, BNORMA} are the rotation rates and accelerations
 of the a-frame relative to an inertial frame.
 For early projects these measurements were not recorded, and for most projects
 they have not been retained in the archived files.
 This appendix describes how they can be retrieved from the measurements
 of attitude angles and the aircraft velocity vector.
 Without Coriolis corrections, the answers would be straightforward: Differentia
te the measured angles and components of the aircraft velocity and transform
 the results to the a-frame.
 However, the inertial contributions from motion and rotation of the a-frame,
 while minor, are not negligible.
 The needed corrections are developed in this section, to complement the
 outlined solutions presented in the technical note.
\end_layout

\begin_layout Subsection
Accelerations
\end_layout

\begin_layout Standard
The accelerations in the a-frame are reconstructed as follows:
\end_layout

\begin_layout Enumerate
Construct a vector representing the aircraft motion from the variables {VEW,
 VNS, VSPD} as produced by the INS.
\end_layout

\begin_layout Enumerate
Introduce interpolation at missing values to avoid failure of the code in
 the next step.
 The routine used was that provided by the 
\begin_inset Quotes eld
\end_inset

na.approx
\begin_inset space ~
\end_inset

()
\begin_inset Quotes erd
\end_inset

 function in the 
\begin_inset Quotes eld
\end_inset

zoo
\begin_inset Quotes erd
\end_inset

 package for R.
\end_layout

\begin_layout Enumerate
Differentiate the time series, either using the R function 
\begin_inset Quotes eld
\end_inset

diff
\begin_inset space ~
\end_inset

()
\begin_inset Quotes erd
\end_inset

 or, to introduce some smoothing, Savitzgy-Golay polynomials.
 The 
\begin_inset Quotes eld
\end_inset

sgolayfilt
\begin_inset space ~
\end_inset

()
\begin_inset Quotes erd
\end_inset

 function in the 
\begin_inset Quotes eld
\end_inset

signal
\begin_inset Quotes erd
\end_inset

 package for R was used, and the derivative was determined over 11 1-Hz
 samples.
 With an appropriate argument, this function returns the derivative when
 called with the time series as an argument.
\end_layout

\begin_layout Enumerate
For the third (vertical) component, change the sign and subtract the acceleratio
n of gravity.
\end_layout

\begin_layout Enumerate
Add the rotation correction (usually subtracted during translation from
 the a-frame to the l-frame) as calculated by the function 
\begin_inset Quotes eld
\end_inset

RotationCorrection
\begin_inset space ~
\end_inset

()
\begin_inset Quotes erd
\end_inset

.
 The correction can be explained by discussing the following code for that
 function.
 Argument 
\begin_inset Quotes eld
\end_inset

.data.
\begin_inset Quotes erd
\end_inset

 is an R data.frame containing the latitude and altitude in variables .data$LAT
 and .data$GGALT.
 The vector 
\begin_inset Quotes eld
\end_inset

.V
\begin_inset Quotes erd
\end_inset

 is the l-frame vector representing aircraft velocity.
 The function treats the input arguments as arrays, so it will provide correctio
ns for the entire flight on one call.
 When used to correct just one vector, the dimensions of 
\begin_inset Quotes eld
\end_inset

.V
\begin_inset Quotes erd
\end_inset

 must be changed to 1x3 for consistency with the vectorized structure of
 the function.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout LyX-Code
RotationCorrection <- function (.data, .V) {
\end_layout

\begin_layout LyX-Code
  omegaE <- StandardConstant ('Omega') ## Earth's angular velocity
\end_layout

\begin_layout LyX-Code
  C <- vector ('numeric', 3*(DL <- nrow(.data))); dim(C) <- c(DL,3)
\end_layout

\begin_layout LyX-Code
  if (DL == 1) {dim (.V) <- c(1,3)}    ## for consistency, vectorization
\end_layout

\begin_layout LyX-Code
  lat <- .data$LAT * pi / 180          ## convert to radians
\end_layout

\begin_layout LyX-Code
  sinLat <- sin(lat); cosLat <- cos(lat); tanLat <- tan(lat)
\end_layout

\begin_layout LyX-Code
  Ree <- 6378137; Ecc <- 0.08181919    ## constants for Earth radii
\end_layout

\begin_layout LyX-Code
  Rn <- Ree / (1 - (Ecc * sinLat)^2)^0.5 
\end_layout

\begin_layout LyX-Code
  Rm <- Rn * (1 - Ecc^2) / (1 - (Ecc * sinLat)^2) + .data$GGALT
\end_layout

\begin_layout LyX-Code
  Rn <- Rn + .data$GGALT
\end_layout

\begin_layout LyX-Code
  omega <- as.vector (-.V[,2] / Rm, 2 * omegaE * cosLat + .V[,1] / Rn,
\end_layout

\begin_layout LyX-Code
                      2 * omegaE * sinLat + .V[,1] * tanLat / Rn)
\end_layout

\begin_layout LyX-Code
  dim(omega) <- c(DL, 3)
\end_layout

\begin_layout LyX-Code
  zro <- rep(0, DL)
\end_layout

\begin_layout LyX-Code
  M <- array (c(zro, -omega[3], omega[2], omega[3], zro, -omega[1],
\end_layout

\begin_layout LyX-Code
                 -omega[2], omega[1], zro), dim=c(DL, 3, 3))    ## skew-symmetri
c 
\end_layout

\begin_layout LyX-Code
  MP <- aperm(M)
\end_layout

\begin_layout LyX-Code
  ## R uses column-major representation of matrices.
 Matrix multiplication, each row:
\end_layout

\begin_layout LyX-Code
  for (i in 1:DL) {C[i,] <- MP[,,i] %*% .V[i,]}   
\end_layout

\begin_layout LyX-Code
  return (C)
\end_layout

\begin_layout LyX-Code
}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Apply the transformation matrix that transforms from the l-frame to the
 a-frame.
 This is the transpose of (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:XformLA"

\end_inset

).
\end_layout

\begin_layout Enumerate
Subtract the acceleration of gravity from the third component.
\end_layout

\begin_layout Subsection
Rotation rates
\end_layout

\begin_layout Standard
The equations used for mechanization were developed in this report and in
 the workflow description that accompanies it.
 In the case of the attitude angles, the derivatives of the attitude angles
 were obtained by expressing those angles in terms of appropriate components
 of the rotation matrix, for example by finding the time derivative of pitch
 from 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\dot{\theta}=d(\frac{\mathrm{d(}\arcsin(-R_{a}^{l}[3,1])\mathrm{)}}{\mathrm{d}t}=\frac{-1}{\sqrt{1-R_{a}^{l}[3,1]^{2}}}\dot{R}_{a}^{l}[3,1]
\]

\end_inset

where 
\begin_inset Formula $\boldsymbol{R}_{a}^{l}$
\end_inset

 is the transformation matrix from the a-frame to the l-frame, which has
 component [3,1] equal to 
\begin_inset Formula $-\sin\theta$
\end_inset

.
 The derivative of the transformation matrix 
\begin_inset Formula $\boldsymbol{\dot{R}_{a}^{l}}$
\end_inset

 is found by transforming the measured body rotation rates to the l-frame
 and then adding the inertial correction term 
\begin_inset Formula $-\Omega_{il}^{a}\boldsymbol{R}_{a}^{l}$
\end_inset

 where, if 
\begin_inset Formula $\omega$
\end_inset

 is defined as
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\omega=\left[\begin{array}{c}
-v_{e}/(R_{M}+z)\\
\Omega_{E}\cos\lambda+(v_{n}/(R_{n}+z))\\
\Omega_{E}\sin\lambda+(v_{n}\tan\lambda/(R_{N}+z))
\end{array}\right]
\]

\end_inset

with 
\begin_inset Formula $\Omega_{E}$
\end_inset

 the angular rotation rate of the Earth, the skew-symmetric representation
 of 
\begin_inset Formula $\omega$
\end_inset

 is 
\begin_inset Formula $\Omega_{il}^{l}$
\end_inset

: 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\Omega_{il}^{l}=\left[\begin{array}{ccc}
0 & -\omega_{3} & \omega_{2}\\
\omega_{3} & 0 & -\omega_{1}\\
-\omega_{2} & \omega_{1} & 0
\end{array}\right]
\]

\end_inset

To reverse this procedure, start with the representation of the derivative
 of the transformation matrix, now expressed in terms of the l-frame angular
 rates represented by {
\begin_inset Formula $\dot{\theta}$
\end_inset

, 
\begin_inset Formula $\dot{\phi}$
\end_inset

, 
\begin_inset Formula $\dot{\psi}$
\end_inset

}, which can be determined by differentiating the measurements of pitch,
 roll, and heading.
 This is 
\begin_inset Formula $\dot{\boldsymbol{R}}_{a}^{l}$
\end_inset

, and its components in terms of the derivatives of the measured angles
 are as follows:
\end_layout

\begin_layout Quotation
[1,1]: dR[1,1]dt = d(
\begin_inset Formula $\sin\psi\cos\theta$
\end_inset

)/dt = 
\begin_inset Formula $\dot{\psi}\cos\psi\cos\theta-\dot{\theta}\sin\psi\sin\theta$
\end_inset


\end_layout

\begin_layout Quotation
[1,2]: 
\begin_inset Formula $\sin\psi\sin\theta\sin\phi+\cos\psi\cos\phi\rightarrow\dot{\psi}(\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi)+\dot{\theta}\sin\psi\cos\theta\sin\phi+\dot{\phi}(\sin\psi\sin\theta\cos\phi-\cos\psi\sin\phi)$
\end_inset


\end_layout

\begin_layout Quotation
[1,3]: 
\begin_inset Formula $\cos\psi\sin\phi-\sin\psi\sin\theta\cos\phi\rightarrow\dot{\psi}(-\sin\psi\sin\phi-\cos\psi\sin\theta\cos\phi)+\dot{\theta(-}\sin\psi\cos\theta\cos\phi)+\dot{\phi}(\cos\psi\cos\phi+\sin\psi\sin\theta\sin\phi)$
\end_inset


\end_layout

\begin_layout Quotation
[2,1]: 
\begin_inset Formula $\cos\psi\cos\theta\rightarrow\dot{\psi}(-\sin\psi\cos\theta)+\dot{\theta}(-\cos\psi\sin\theta)$
\end_inset


\end_layout

\begin_layout Quotation
[2.2]: 
\begin_inset Formula $\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi\rightarrow\dot{\psi}(-\sin\psi\sin\theta\sin\phi-\cos\psi\cos\phi)+\dot{\theta}\cos\psi\cos\theta\sin\phi+\dot{\phi}(\cos\psi\sin\theta\cos\phi+\sin\psi\sin\phi)$
\end_inset


\end_layout

\begin_layout Quotation
[2.3]: 
\begin_inset Formula $-\cos\psi\sin\theta\cos\phi-\sin\psi\sin\phi\rightarrow\dot{\psi}(\sin\psi\sin\theta\cos\phi-\cos\psi\sin\phi)+\dot{\theta}(-\cos\psi\cos\theta\cos\phi)+\dot{\phi}(\cos\psi\sin\theta\sin\phi-\sin\psi\cos\phi)$
\end_inset


\end_layout

\begin_layout Quotation
[3,1]: 
\begin_inset Formula $-\sin\theta\rightarrow\dot{\theta}(-\cos\theta)$
\end_inset


\end_layout

\begin_layout Quotation
[3,2]: 
\begin_inset Formula $\cos\theta\sin\phi\rightarrow\dot{\theta}(-\sin\theta\sin\phi)+\dot{\phi}\cos\theta\cos\phi$
\end_inset


\end_layout

\begin_layout Quotation
[3,3]: 
\begin_inset Formula $-\cos\theta\cos\phi\rightarrow\dot{\theta}\sin\theta\cos\phi+\dot{\phi}\cos\theta\sin\phi$
\end_inset


\end_layout

\begin_layout Standard
Add to this the correction for inertial effects (i.e., 
\begin_inset Formula $+\boldsymbol{\Omega}_{il}^{a}\boldsymbol{R}_{a}^{l}$
\end_inset

), then transform back to the a-frame using 
\begin_inset Formula $\boldsymbol{R}_{l}^{a}$
\end_inset

 (i.e., the inverse of 
\begin_inset Formula $\boldsymbol{R}_{a}^{l}$
\end_inset

) to get the skew-symmetric representation of the rotation rates as measured
 in the a-frame.
 Then, for example, the [3,1] component of the result is 
\begin_inset Formula $-$
\end_inset

BPITCHR.
\end_layout

\begin_layout Section
Discussion of Section 4 regarding the Kalman filter
\end_layout

\begin_layout Subsection
The vectors and matrices
\end_layout

\begin_layout Standard
The main report defines some vectors and matrices used in the error-state
 Kalman filter.
 Here some of the associated R code is included to make these definitions
 specific.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
SVE At initialization, the error-state vector is set to SVE <- c(DZ[1, 1:6],
 rep(0, 9)) where DZ[1, 1:6] is a vector containing the initial values of
 the differences between the first six INS-provided state variables and
 the corresponding GPS-provided variables.
 That is, DZ=c(LAT-GGLAT, LON-GGLON, ALT-GGALT, VEW-GGVEW, VNS-GGVNS, VSPD-GGVSP
D) where all values are read from the data archive at the initial time.
 All quantities at initialization and during the integration are used in
 units of radians, including latitude and longitude.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dcm The transition matrix 
\begin_inset Formula $\boldsymbol{T}_{k,k-1}$
\end_inset

is calculated, for a specified time during the integration, as follows:
\begin_inset Newline newline
\end_inset

o The 15 components of the state vector sv from the INS mechanization are
 read from the data archive.
\begin_inset Newline newline
\end_inset

o dcm <- jacobian (STMFV, sv, .aaframe='l') * dt * NSTEP + diag(15)
\begin_inset Newline newline
\end_inset

The arguments to the jacobian function are the derivative function STMFV
 discussed above, the state vector, and .aaframe which in this case specifies
 that the attitude angles should be the 
\emph on
l-
\emph default
frame values, as is discussed below.
 The variable dt contains the time interval between samples, but for increased
 speed the integration is performed in time steps specified by NSTEP, here
 set to 5.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
CV The covariance matrix is updated during the integration, but it is set
 initially assuming uncertainties of 2 km in horizontal coordinates, 0.5
\begin_inset space ~
\end_inset

km in vertical coordinate, 2
\begin_inset space ~
\end_inset

m/s in all velocity components, 0.3
\begin_inset Formula $^{\circ}$
\end_inset

in pitch and roll, 1
\begin_inset Formula $^{\circ}$
\end_inset

 in heading, 0.005
\begin_inset Formula $^{\circ}$
\end_inset

/s for the rotation rates about the pitch and roll axes, 0.01
\begin_inset Formula $^{\circ}$
\end_inset

/s for the rotation rate about the yaw axis, and 0.0005
\begin_inset space \thinspace{}
\end_inset

m/s
\begin_inset Formula $^{2}$
\end_inset

 for each component of the acceleration.
 The squares of these values are entered into the diagonal elements of CV,
 and off-diagonal elements are left zero at the start of the integration.
 These values were selected to be reasonably consistent with the specifications
 of the INS where known.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
K The Kalman-gain matrix will be discussed in subsequent sections.
 It is calculated independently at each step during the integration, so
 it does not need to be initialized.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
DZ The measurement errors as determined from comparison between the INS-provided
 variables and the corresponding GPS-provided values.
 This is initialized in a data.frame at the start of the integration, where
 that data.frame contains all the measurements from the flight.
 For the error-state Kalman filter, 1-Hz measurements were sufficient, so
 a standard-rate data file was used.
 The values for each time during the integration are then extracted from
 that data.frame.
 Some preliminary steps were included:
\begin_inset Newline newline
\end_inset

o interpolation to provide any missing-value measurements
\begin_inset Newline newline
\end_inset

o optionally, smoothing with a third order Savitzky-Golay polynomial spanning
 11 s.
\begin_inset Newline newline
\end_inset

o transformation of the attitude angles to the 
\emph on
l-
\emph default
frame, as discussed below.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
H The observation matrix for the initial implementation is a 15
\begin_inset Formula $\times$
\end_inset

6 matrix that indicates that the six components of the measurement-error
 vector DZ correspond to the first 6 components of the error-state vector.
 In R conventions (which includes column-major ordering), H has 6 rows and
 15 columns.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
Q
\begin_inset space ~
\end_inset

and
\begin_inset space ~
\end_inset

R The measurement-noise matrices that apply to the error-state vector and
 the measurement-error vector, respectively.
 These are not adjusted during the integration, so they need to be specified
 using reasonable values.
 Those values can depend on functions of the aircraft-state vector, so the
 matrix does not necessarily remain the same for each step in the integration,
 but they can be specified prior to the integration and saved in data.frames
 so that appropriate values can be read during the integration.
 They are best specified iteratively, by finding adjustments that produce
 results consistent with the error estimates, so the process here will be
 to start with a simple specification for each matrix and then later consider
 how this specification should be changed.
 For Q, the initial choice was a diagonal matrix with diagonal elements
 that are the squares of these estimated standard uncertainties: {5/
\begin_inset Formula $R_{m}$
\end_inset

, 5/
\begin_inset Formula $(R_{n}\cos\lambda)$
\end_inset

, 5, 0.5, 0.5, 0.5, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.002, 0.002} where
 the units match those of the error-state vector (i.e., radians for elements
 1, 2, 7–9, meters for element 3, m/s for elements 4–6, radians/s for elements
 10–12, and m/s
\begin_inset Formula $^{2}$
\end_inset

 for elements 13–15).
 There are important off-diagonal elements that should be included, e.g.,
 to represent strong coupling between the pitch error and the latitude error,
 but this will be reconsidered later.
 For the measurement errors, the noise contributions were estimated initially
 as those giving position errors of 5
\begin_inset space ~
\end_inset

m in each horizontal position component, 10
\begin_inset space ~
\end_inset

m in the altitude, and 0.1
\begin_inset space ~
\end_inset

m/s in each velocity component.
\end_layout

\begin_layout Standard
xx
\end_layout

\begin_layout Section
The pitch-correction algorithm
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

2.1: The basis for the correction
\end_layout

\begin_layout Standard
After an introduction, Sect.
\begin_inset space ~
\end_inset

2 of the manuscript develops and applies the algorithm for correcting pitch
 and roll.
 Section
\begin_inset space ~
\end_inset

2.1 is an outline of basic theory, as also developed in more detail in 
\begin_inset CommandInset citation
LatexCommand citet
key "Cooper2016ncartn"

\end_inset

.
 This is based on standard analysis such as is available in 
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

.
 One subtlety may be worth mention here.
 The Schuler oscillation involves coupling among the errors in Earth-relative
 velocity, pitch or roll angle, and latitude or longitude.
 These are strongly coupled through the INS in order to maintain bounds
 on the growth of the errors.
 The choice developed here, represented in Equations (2) and (3), is to
 relate the pitch or roll errors to the acceleration errors.
 An acceleration error also leads to a position error and so to errors in
 latitude and longitude, and it might appear that those errors should also
 enter the error in pitch, but the IRS includes the measured acceleration
 and so the measured position in its integration and so already compensates
 the measured pitch for this error.
 Other representations of the Schuler coupling among these errors could
 be used, but they are equivalent so it is most straightforward to represent
 the error in pitch or roll in terms of the errors in acceleration.
 
\end_layout

\begin_layout Subsection*
Manuscript Sect._2.2: An example
\end_layout

\begin_layout Standard
In general, it is necessary to transform the errors in pitch obtained from
 (2) and (3) to the reference frame of the aircraft, but there is one flight
 of the NSF/NCAR GV that was almost directly southbound for the full flight
 so for that flight the angle transformations are not necessary except for
 the need to reverse the signs of the pitch and roll errors to account for
 the flight direction.
 For the purpose of illustrating how the pitch error is coupled to the ground-sp
eed errors through the Earth-relative acceleration, measurements from that
 flight (from 1 June 2014, flying from Kona, Hawaii to Pago-Pago) were used.
 Figure 1, top, shows the ground-speed errors estimated by the difference
 between IRS-provided measurements and those from a GPS receiver.
 In the data file for this flight, these are variables {VEW, VNS} from the
 INS and {GGVEW, GGVNS} from the GPS receiver.
 The netCDF file was called DEEPWAVEff02.nc, and the plot was generated in
 R chunk 
\begin_inset Quotes eld
\end_inset

v-errors-straight-leg
\begin_inset Quotes erd
\end_inset

 using 
\begin_inset Quotes eld
\end_inset

plotWAC()
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

lineWAC()
\begin_inset Quotes erd
\end_inset

, convenience functions in Ranadu that call the standard R graphics routines
 with particular options.
 For the bottom plot, the derivatives of the error components shown in the
 top plot were calculated using signal::sgolayfilt(), which has the option
 of calculating the derivative while using a Savitzky-Golay filter.
 A length of 1013 points was chosen because that spans about 1/5 of a Schuler
 oscillation, and a third-order filter was chosen.
 There are about 15
\begin_inset space ~
\end_inset

s of missing values in the time series for VEW and VNS, and the filter call
 fails if the time series includes missing values, so before calling the
 filter the routine zoo::na.approx() was used to interpolate across the gap.
 The steps in the correction algorithm will be discussed again in the subsequent
 section where the pitch-correction function is described.
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

2.3: Transformation of the attitude angles
\end_layout

\begin_layout Standard
This section develops the transformation needed to obtain the pitch and
 roll errors in the aircraft-body frame or 
\begin_inset Formula $a$
\end_inset

-frame from the 
\begin_inset Formula $l$
\end_inset

-frame errors provided by (2) and (3).
 The transformation is a simple rotation by the negative of the heading
 angle.
 The transformation is developed by using a unit vector representing the
 platform orientation and considering how the components of that unit vector
 transform under rotation.
 The the definitions of the pitch and roll angles are used in Eqs.
\begin_inset space ~
\end_inset

(6) to obtain the pitch and roll errors in the 
\begin_inset Formula $a$
\end_inset

-frame.
 The signs can be checked as follows: For 
\begin_inset Formula $\psi=\pi/2$
\end_inset

, 
\begin_inset Formula $\delta\theta^{(a)}=-\delta\phi^{(l)}$
\end_inset

 and 
\begin_inset Formula $\delta\phi^{(a)}=\delta\theta^{(l)}$
\end_inset

; for 
\begin_inset Formula $\psi=-\pi/2,$
\end_inset

 
\begin_inset Formula $\delta\theta^{(a)}=\delta\phi^{(l)}$
\end_inset

 and 
\begin_inset Formula $\delta\phi^{(a)}=-\delta\theta^{(l)}$
\end_inset

; and for 
\begin_inset Formula $\psi=\pi$
\end_inset

 both components change sign.
 This conforms to expected behavior from visualization of the misalignment
 vector under these conditions.
\end_layout

\begin_layout Subsection*
The Ranadu::CorrectPitch() function:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<pitch-correction-workflow, include=FALSE, eval=FALSE, fig.cap="General
 workflow diagram for the Ranadu function CorrectPitch(), which returns
 error values of pitch and roll that should be subtracted from the measurements."
>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

library (DiagrammeR)
\end_layout

\begin_layout Plain Layout

setwd ("~/RStudio/DEEPWAVE/WindUncertainty")
\end_layout

\begin_layout Plain Layout

grViz ("./DGM-PC.dot", engine='dot')
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename ../../AMTD-AAC/DGM-PC-r.png
	lyxscale 50
	width 90text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Workflow diagram for the Ranadu function CorrectPitch(), which returns estimates
 of errors in measurements of pitch and roll.
 The returned values, with units of degrees, should be subtracted from the
 measurements to obtain corrected values.
\begin_inset CommandInset label
LatexCommand label
name "fig:pitch-correction-workflow"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
A function to calculate the errors in pitch and roll was developed and incorpora
ted into the Ranadu package on the basis of the above steps, to facilitate
 correction of the measurements.
 That function is described in detail here, and the authoritative reference
 is the code contained in 
\begin_inset Quotes eld
\end_inset

PitchCorrection.R
\begin_inset Quotes erd
\end_inset

 at the Ranadu GitHub site referenced earlier.
 The function takes as input a data.frame containing the variables VNS, VEW,
 GGVNS, GGVEW, LAT or LATC, GGALT, PITCH, ROLL, and THDG, which are respectively
 the north and east component of the ground speed from the IRS, the correspondin
g components from the GPS, the latitude, the geometric altitude, and the
 pitch, roll, and heading angles, in units of m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-1}$
\end_inset

 or m or 
\begin_inset Formula $^{\circ}$
\end_inset

 as appropriate.
 A workflow diagram for the function is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:pitch-correction-workflow}
\end_layout

\end_inset

.
 The steps in the algorithm are these:
\end_layout

\begin_layout Enumerate
Prepare the data.frame:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Test to see if all required variables are present in the input data.frame;
 return 0 otherwise.
\end_layout

\begin_layout Enumerate
Determine the data rate of the input data.frame from the time difference
 between samples.
 If it is higher than 1
\begin_inset space ~
\end_inset

Hz, extract a working 1-Hz data frame to use for the calculations.
 This greatly improves performance for high-rate files.
 
\end_layout

\begin_layout Enumerate
Allow for either LAT or LATC to provide the latitude required for the gravity
 routine.
\end_layout

\begin_layout Enumerate
Interpolate to fill in missing values for VNS, VEW, GGVNS, GGVEW, using
 the zoo::na.approx() function.
 If there are remaining missing-value elements in the time series (which
 can occur if the gaps exceed 1000
\begin_inset space ~
\end_inset

s), set the values to zero for those regions to avoid failure at the next
 step.
 The variable MaxGap in the function determines the maximum gap for interpolatio
n; it can be changed only by changing the code.
\end_layout

\end_deeper
\begin_layout Enumerate
Calculate the derivatives:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Quotation
Determine the derivatives of the error terms (VNS-GGVNS) and (VEW-GGVEW)
 using third-order Savitzky-Golay filters, specifically the R function signal::s
golayfilt().
 Use a span of 1013 points (changeable via an argument to CorrectPitch())
 and calculate the first derivative by supplying an appropriate argument
 (m=1) to the filter routine.
\end_layout

\end_deeper
\begin_layout Enumerate
Find the errors in pitch and roll:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Calculate the acceleration of gravity as a function of latitude and altitude
 using the Ranadu function Gravity() and divide the derivatives (with appropriat
e sign) by this value to get the 
\begin_inset Formula $l$
\end_inset

-frame errors in pitch and roll.
\end_layout

\begin_layout Enumerate
Transform the result to the 
\begin_inset Formula $a$
\end_inset

-frame using manuscript equation (6).
\end_layout

\end_deeper
\begin_layout Enumerate
Construct the matrix to return, which has rows matching the input data.frame
 and two columns, the first representing the pitch error and the second
 the roll error.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
If the data rate of the original data.frame is higher than 1
\begin_inset space ~
\end_inset

Hz, interpolate the working 1-Hz data.frame to the original rate, again using
 zoo::na.approx() for linear interpolation.
\end_layout

\begin_layout Enumerate
Concatenate the two vectors representing the pitch and roll errors to one
 vector.
\end_layout

\begin_layout Enumerate
Convert to an appropriate matrix with dimensions [DL,2] where DL is the
 length of the original data.frame.
 This conversion uses 
\begin_inset Quotes eld
\end_inset

dim()
\begin_inset Quotes erd
\end_inset

 with the concatenated vector.
 
\end_layout

\end_deeper
\begin_layout Enumerate
Return a two-dimensional array with the two components being the 
\begin_inset Formula $a$
\end_inset

-frame errors in pitch and roll, so that the result can be used to obtain
 corrected values of the pitch and roll via
\begin_inset Newline newline
\end_inset


\family typewriter

\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

PITCHC <- D$PITCH - CorrectPitch (D)[,1]
\begin_inset Newline newline
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

ROLLC 
\begin_inset space ~
\end_inset

<- D$ROLL - CorrectPitch (D)[,2]
\end_layout

\begin_layout Standard
All steps in this function are vectorized, to operate on the entire time
 series in vectorized function calls.
 Even for high-rate data.frames, the processing involves little delay: On
 a modest linux desktop system, processing a 7-h 25-Hz file takes about
 2
\begin_inset space ~
\end_inset

s.
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

2.5: Discussion
\end_layout

\begin_layout Standard
This section is mostly opinion and assessment and did not require calculations
 except for order-of-magnitude estimates explained in the text.
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

2.6: Some details regarding smoothing
\end_layout

\begin_layout Standard
The comments in this section have already been discussed in regard to the
 
\begin_inset Quotes eld
\end_inset

CorrectPitch()
\begin_inset Quotes erd
\end_inset

 function.
 This section makes some of those aspects of the algorithm more specific
 in the manuscript.
\end_layout

\begin_layout Section
The heading-correction algorithm
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

3.1: The basis for the correction
\end_layout

\begin_layout Standard
This section is theoretical, with equations developed as described, so additiona
l description of the workflow is not useful.
 The details will be provided later with the description of the heading-correcti
on algorithm.
\end_layout

\begin_layout Subsection*
Manuscript Sect.\SpecialChar softhyphen
3.2: The transformation from 
\begin_inset Formula $a$
\end_inset

-frame to 
\begin_inset Formula $l$
\end_inset

-frame
\end_layout

\begin_layout Standard
The key to implementation of the proposed algorithm is transformation of
 the measured accelerations to a reference frame where they can be compared
 to the observed accelerations via GPS.
 The transformation itself was described in detail in Sect.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:XformLA"

\end_inset

, and two references for this transformation are listed in the manuscript.
 As checks, the transformations given in those two references (Eq.
\begin_inset space ~
\end_inset

2.6 in 
\begin_inset CommandInset citation
LatexCommand citet
key "Bulletin23"

\end_inset

 and Eq.
\begin_inset space ~
\end_inset

2-82 in 
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

) were further transformed to give directly the 
\begin_inset Formula $a$
\end_inset

-frame-to-
\begin_inset Formula $l$
\end_inset

-frame transformation, with signs of rotation angles as required, and each
 led to (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:XformLA"

\end_inset

) as quoted in Sect.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:XformLA"

\end_inset

.
 
\end_layout

\begin_layout Standard
It seemed useful to check that this transformation gives 
\begin_inset Formula $l$
\end_inset

-frame accelerations in reasonable agreement with those measured by GPS,
 so several checks were performed.
 One, reported in the manuscript, used a circle maneuver flown during DEEPWAVE
 research flight 15.
 The circle maneuvers are discussed in considerable detail in Sect.
\begin_inset space ~
\end_inset

7.1 of 
\begin_inset CommandInset citation
LatexCommand citet
key "Cooper2016ncartn"

\end_inset

, where plots of the flight track in a coordinate frame drifting with the
 wind show that the Lagrangian tracks are close approximations to circles.
 They were flown under control of the flight management system of the aircraft,
 which was able to maintain constant roll angle to a tolerance of a fraction
 of a degree.
 Two circles were flown in left turns, then two additional circles were
 flown in right turns.
 The ground-speed components measured by GPS were differentiated to obtain
 reference measurements of the corresponding acceleration components, again
 using the approach of replacing missing values by interpolation and then
 using fitted Savitzgy-Golay polynomials to find the derivatives.
 In this case, because the conditions changed too rapidly for the long extents
 used in the pitch-correction algorithm, the length of the polynomials was
 reduced to 21 1-Hz measurements for the horizontal components and 7 1-Hz
 measurements for the vertical component of acceleration.
 The results are shown in Fig.
\begin_inset space ~
\end_inset

3 of the manuscript, as the dotted cyan and orange symbols.
 This plot was generated in R chunks 
\begin_inset Quotes eld
\end_inset

reinitialization
\begin_inset Quotes erd
\end_inset

 (where the data were read and shifted in time using the 
\begin_inset Quotes eld
\end_inset

ShiftInTime()
\begin_inset Quotes erd
\end_inset

 function described in Sect.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:ShiftInTime"

\end_inset

), 
\begin_inset Quotes eld
\end_inset

sg-poly-smoothing
\begin_inset Quotes erd
\end_inset

 (where the interpolation for missing values was included and where derivatives
 of the GPS-measured ground-speed components were calculated using fitted
 Savigzky-Golay polynomials), and 
\begin_inset Quotes eld
\end_inset

get-b-vector-and-transform
\begin_inset Quotes erd
\end_inset

 (where the accelerations were transformed to the 
\begin_inset Formula $l$
\end_inset

-frame).
 To match the GPS-derived accelerations, the transformed accelerations were
 also filtered using Savitzgy-Golay polynomials with the same characteristics
 (but returning the filtered values instead of the derivatives).
 The result of this transformation to the 
\begin_inset Formula $l$
\end_inset

-frame is shown by the blue and green lines in Fig.
\begin_inset space ~
\end_inset

3.
 They match well, confirming the approximate validity of the transformation.
 
\end_layout

\begin_layout Standard
Several other checks were performed also but have not been described in
 the manuscript.
 One important case was to consider a pitch maneuver in which the pitch
 was varied cyclically with about a 20-s period, with wings level but with
 airspeed and altitude varying.
 The maneuver flown on flight 15 during the period of about 4:25:00–4:28:30
 UTC showed strong oscillations in the vertical acceleration, and again
 the body accelerations transformed to the 
\begin_inset Formula $l$
\end_inset

-frame matched will the accelerations deduced from the changes in vertical
 speed measured by the GPS receiver.
 There is commented code in AMTD-AAC.Rnw, at the bottom of chunk 
\begin_inset Quotes eld
\end_inset

get-b-vector-and-transform
\begin_inset Quotes erd
\end_inset

, that would generate this plot if uncommented.
\end_layout

\begin_layout Standard
Some details of the procedure used to generate this plot will be discussed
 more fully in the next subsection, where the heading-correction algorithm
 is discussed.
 One additional aspect needing further discussion here is need to account
 for some rotations relative to an inertial frame.
 The same sources used for the coordinate transformation (
\begin_inset CommandInset citation
LatexCommand citet
key "Bulletin23"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

) provide equations for this correction.
 Here, Eqs.
\begin_inset space ~
\end_inset

5.55–5.57 from 
\begin_inset CommandInset citation
LatexCommand citet
key "noureldin2013fundamentals"

\end_inset

 have been used.
 When these corrections were included, the heading errors deduced as in
 the following subsection changed by typically about 0.01
\begin_inset Formula $^{\circ}$
\end_inset

 while the magnitude of the heading correction was about 0.08
\begin_inset Formula $^{\circ}$
\end_inset

 (for NSF/NCAR GV flight at about 220
\begin_inset space ~
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-1}$
\end_inset

 and at the latitude of New Zealand), so it appears useful to include the
 correction.
 Some approximations appeared acceptable, though, including using a mean
 radius of the Earth, neglecting the height of the aircraft in comparison
 to that radius, and neglecting the small correction that arises from the
 INS being displaced a small distance from the center of gravity of the
 aircraft and therefore experiencing false accelerations during rotation
 of the aircraft.
 
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

3.3: A proposed correction algorithm for heading
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename ../../AMTD-AAC/DGM-HC-r.png
	lyxscale 50
	width 90text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Workflow diagram for the Ranadu function CorrectHeading(), which returns
 estimates of the error in heading.
 The returned values, with units of degrees, should be subtracted from the
 measurements to obtain corrected values.
 Timing adjustments if needed should be made before calling this function.
\begin_inset CommandInset label
LatexCommand label
name "fig:correct-heading-workflow"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

Here, the Ranadu function 
\begin_inset Quotes eld
\end_inset

CorrectHeading()
\begin_inset Quotes erd
\end_inset

 will be discussed to illustrate how the requirements and sequence of steps
 can be implemented.
 This function has a structure similar to that of CorrectPitch(), as shown
 in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:correct-heading-workflow"

\end_inset

, with four sets of tasks related to initial handling of the data, calculation
 of the required accelerations, calculation of the heading correction, and
 formation of the output that the function returns.
 Before calling this function, time shifts should be applied to the measurements
 as needed to obtain coincidence between values reported by the INS and
 the GPS receiver, and if desired corrections to pitch and roll should be
 made and saved in the data.frame as variables PITCHC and ROLLC.
 These will be used in place of PITCH and ROLL if they are present.
 The task description for the function call is as follows:
\end_layout

\begin_layout Enumerate
Prepare the data.frame: This section is the same as for the pitch/roll correction
, except the required variables are different (including the body accelerations
 but not needing the INS-provided ground-speed components) and the interpolation
 for missing values applies to the revised set of variables (BLATA, BLONGA,
 BNORMA, GGVNS, GGVEW, GGALT, LAT, PITCH, ROLL, THDG).
 A 1-Hz data.frame is generated if the input data.frame is higher rate, to
 speed the calculations and because it is not expected that the heading
 error will fluctuate at high frequency (or at least cannot be corrected
 for such fluctuations).
\end_layout

\begin_layout Enumerate
Calculate the accelerations:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Determine the derivatives of the GPS-measured ground-speed components GGVNS
 and GGVEW using third-order Savitzky-Golay filters, specifically the R
 function signal::sgolayfilt().
 In this case, a much shorter span of 21 1-Hz points is used (changeable
 via an argument to CorrectHeading()) because the accelerations change in
 turns much faster than do the velocity errors used in the pitch-correction
 function.
 Again, the first derivative was found by supplying an appropriate argument
 (m=1) to the filter routine.
\end_layout

\begin_layout Enumerate
Calculate the acceleration of gravity as a function of latitude and altitude
 using the Ranadu function Gravity() and add this to the normal component
 of acceleration (BNORMA) provided by the INS, because this is subtracted
 before the normal acceleration is reported.
 Then form a matrix of the 
\begin_inset Formula $a$
\end_inset

-frame accelerations that has three columns and a number of rows matching
 the length of the working 1-Hz data.frame.
\end_layout

\begin_layout Enumerate
Transform the resulting matrix to the 
\begin_inset Formula $a$
\end_inset

-frame using the Ranadu transformation routine 
\begin_inset Quotes eld
\end_inset

XformLA ()
\begin_inset Quotes erd
\end_inset

, described in Sect.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:XformLA"

\end_inset

 above, which returns a matrix containing the corresponding 
\begin_inset Formula $l$
\end_inset

-frame accelerations.
 After transformation, again add the acceleration of gravity to the third
 component (with positive sign because the direction of the 
\begin_inset Formula $z$
\end_inset

-axis is now upward).
\end_layout

\begin_layout Enumerate
Adjust the resulting accelerations for the rotation terms given by (11)–(13).
 
\end_layout

\begin_layout Enumerate
Apply the same-span and same-order Savitzky-Golay filter to the transformed
 
\begin_inset Formula $l$
\end_inset

-frame accelerations from the INS, to match the filtering applied to the
 GPS measurements.
\end_layout

\end_deeper
\begin_layout Enumerate
Find the error in heading:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Use (10) from the manuscript to estimate the heading error at each point.
 Qualify these values by requiring that the magnitude of the horizontal
 acceleration be greater than 1
\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

 for the estimate to be considered valid; replace others with the missing-value
 flag NA.
\end_layout

\begin_layout Enumerate
Search for turns, separately assembling data from left turns (ROLL<-10
\begin_inset Formula $^{\circ}$
\end_inset

) and from right turns (ROLL>10
\begin_inset Formula $^{\circ}$
\end_inset

).
 End each segment when there are 5 min of flight without meeting either
 turn criterion.
 If the accumulated measurements have at least 25 1-Hz measurements in each
 turn direction, consider this to be valid data for estimating the heading
 correction and save the mean values and standard deviations for each turn
 direction, along with the mean time, in accumulation arrays.
 If the accumulated measurements do not meet this test, discard.
 In either case, reinitialize to look for the next segment.
 The internal parameters TGAP and NSL respectively set the 5-min and 25-sample
 tests in the function; they can only be changed at present by changing
 the code.
\end_layout

\begin_layout Enumerate
Test the number of qualifying turns:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
If less than three, return a default value (-0.08).
 This can be provided as an optional argument (.default) to the function.
 
\end_layout

\begin_layout Enumerate
Otherwise, form the accumulated characteristics from the turns, including
 the mean error and the standard deviation, into a data.frame named EH.
 
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate
Calculate the vector of error estimates to return from the function:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
If the default value has not already been returned, fit a cubic spline to
 the accumulated measurements from qualifying turns.
 The fit is determined using the R function 
\begin_inset Quotes eld
\end_inset

smooth.spline ()
\begin_inset Quotes erd
\end_inset

 with a number of degrees of freedom equal to one less than twice the number
 of qualifying turns (because each qualifying turn provides two data points,
 one for each turn direction), with weights for each point equal to the
 inverse of the variance of the contributing measurements of heading error,
 and with a parameter 
\begin_inset Quotes eld
\end_inset

spar
\begin_inset Quotes erd
\end_inset

 set to 0.7.
 The latter determines the degree of smoothing, and this choice was the
 result of exploration with various parameters.
 This appears to provide a reasonable representation of the variation in
 the measurements while maintaining a slowly varying result over the course
 of research flights.
 Exploration with a variety of research flights led to this choice, but
 there is no further backup for this choice except that it seemed to produce
 reasonable results.
 The R documentation for the basic graphics package includes more discussion
 of the fit routine and the effect of the 
\begin_inset Quotes eld
\end_inset

spar
\begin_inset Quotes erd
\end_inset

 parameter, and it also provides literature references.
\end_layout

\begin_layout Enumerate
Construct the vector to return using the fitted cubic spline to find the
 value of the estimated heading error for each time in the input data.frame.
 The heading can then be corrected via
\begin_inset Newline newline
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

THDGC <- D$THDG - CorrectHeading (D)
\end_layout

\end_deeper
\begin_layout Standard
The routine also includes optional code, enabled by setting 
\begin_inset Quotes eld
\end_inset

GeneratePlot <- TRUE
\begin_inset Quotes erd
\end_inset

 at the beginning of the routine, to create a plot showing the results.
 This code is normally inactive but can be copied or activated when it is
 useful to see the results in plotted form.
\end_layout

\begin_layout Subsection*
Manuscript Sect.
\begin_inset space ~
\end_inset

3.4: Examples
\end_layout

\begin_layout Standard
This manuscript section presents the result of applying the preceding algorithm
 to two research flights.
 
\end_layout

\begin_layout Standard
For the first, a plot of the individual 
\begin_inset Quotes eld
\end_inset

qualified
\begin_inset Quotes erd
\end_inset

 measurements (primarily, with magnitude of the horizontal acceleration
 greater than 1
\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

), each representing a measurement over 1
\begin_inset space \thinspace{}
\end_inset

s, is included as Fig.
\begin_inset space ~
\end_inset

4.
 This is generated in R chunk 
\begin_inset Quotes eld
\end_inset

error-components
\begin_inset Quotes erd
\end_inset

 using standard R graphics via the Ranadu::plotWAC() function.
 To generate the included smoothed line, a variable was introduced that
 initially had value equal to the mean heading error for the full set of
 measurements shown, then these values were replaced by the qualified measuremen
ts of heading error where they existed, and the result was filtered using
 a be-directional Butterworth low-pass filter with a cutoff period of 5
\begin_inset space ~
\end_inset

min.
 
\end_layout

\begin_layout Standard
A plot of the result of applying the heading correction algorithm discussed
 above was also included, as Fig.
\begin_inset space ~
\end_inset

5.
 This was generated using the R 
\begin_inset Quotes eld
\end_inset

ggplot2
\begin_inset Quotes erd
\end_inset

 graphics package using the data.frame 
\begin_inset Quotes eld
\end_inset

HC
\begin_inset Quotes erd
\end_inset

 generated as described in the discussion of the heading-correction algorithm.
 This plot is generated in R chunk 
\begin_inset Quotes eld
\end_inset

plot-heading-correction-rf15
\begin_inset Quotes erd
\end_inset

 in the AMTD-AAC.Rnw program file.
 The plot superimposes results from calls to 
\begin_inset Quotes eld
\end_inset

geom_errorbar()
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

geom_point()
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

geom_line
\begin_inset Quotes erd
\end_inset

, the latter showing results of the spline fit.
 
\end_layout

\begin_layout Standard
The error bars need clarification here.
 These are estimates of the standard deviation of the mean that applies
 to each point determined for a qualifying turn.
 However, the points are not independent samples because smoothing has been
 applied to the accelerations before determining the estimated errors and
 because there is some inherent distance over which the estimates are correlated.
 A Savitzky-Golay smoothing polynomial gives an effective reduction in variance
 of about 
\begin_inset Formula $9/(4M)$
\end_inset

 where 
\begin_inset Formula $M$
\end_inset

 is the span of the polynomial, so for 
\begin_inset Formula $M=21$
\end_inset

 the effective reduction is about a factor of 0.11 in variance, as would
 result from averaging about 9 points.
 Therefore, it is assumed that the effect of averaging points is to reduce
 the variance by 
\begin_inset Formula $(N/9)^{-1}$
\end_inset

 rather than 
\begin_inset Formula $N^{-1}$
\end_inset

, so the standard deviation of the mean 
\begin_inset Formula $\sigma_{m}$
\end_inset

 is at least 
\begin_inset Formula $\sigma/\sqrt{N/9}$
\end_inset

 rather than 
\begin_inset Formula $\sigma/\sqrt{N}$
\end_inset

 where 
\begin_inset Formula $\sigma$
\end_inset

 is the sample standard deviation.
 These standard deviations in the mean values still appear unrealistically
 small, and smoothed splines typically intersect only about 40% of the error
 bars.
 To obtain error bars for which about 63% of the error bars are intersected
 by reasonable spline fits, it would be necessary to increase the standard
 deviations by an additional factor of about 2.
 Because the error bars otherwise look so small, the plots show two-standard-dev
iation error bars for the errors in the mean values, as noted in the captions.
 Weight factors as used to fit the cubic spline are 
\begin_inset Formula $1/\sigma_{m}^{2}$
\end_inset

 so they remain proportional to 
\begin_inset Formula $N$
\end_inset

 and are not affected by this assumed correlation, but this choice affects
 the size of the plotted error bars in Figs.
\begin_inset space ~
\end_inset

5 and 6.
\end_layout

\begin_layout Standard
The plot for the second example, Fig.
\begin_inset space ~
\end_inset

6, was constructed in the same way.
 The plot is generated in R chunk 
\begin_inset Quotes eld
\end_inset

spline-plot
\begin_inset Quotes erd
\end_inset

, where the weighted mean and weighted standard deviation for the heading
 correction are also calculated.
 They are incorporated into the text via 
\begin_inset Quotes eld
\end_inset


\backslash
Sexpr()
\begin_inset Quotes erd
\end_inset

 calls.
\end_layout

\begin_layout Section
Some properties of the corrections (Manuscript Sect.
\begin_inset space ~
\end_inset

4)
\end_layout

\begin_layout Subsection*
The pitch correction
\end_layout

\begin_layout Standard
The intent of this section is to illustrate typical magnitudes of the deduced
 corrections and so to support assessment of their importance.
 
\end_layout

\begin_layout Enumerate
Figure
\begin_inset space ~
\end_inset

7 shows values of the heading correction for a representative flight.
 This was generated in R chunk 
\begin_inset Quotes eld
\end_inset

typical-errors
\begin_inset Quotes erd
\end_inset

 using the R ggplot2 routine 
\begin_inset Quotes eld
\end_inset

geom_density()
\begin_inset Quotes erd
\end_inset

.
\end_layout

\begin_layout Enumerate
The reverse-heading legs are discussed in more detail in 
\begin_inset CommandInset citation
LatexCommand citet
key "Cooper2016ncartn"

\end_inset

, Sect.
\begin_inset space ~
\end_inset

6.4.7.
 The workflow included identifying the reverse-heading times, but that had
 already been done for inclusion in that technical note, so the same times
 are included here.
 More discussion of this selection is included with a workflow statement
 that accompanies that reference.
 The plots are generated in R chunk 
\begin_inset Quotes eld
\end_inset

reverse-course-w-comparison
\begin_inset Quotes erd
\end_inset

 using the R routine 
\begin_inset Quotes eld
\end_inset

hist()
\begin_inset Quotes erd
\end_inset

, part of standard R graphics.
 The pitch correction was calculated using the 
\begin_inset Quotes eld
\end_inset

CorrectPitch()
\begin_inset Quotes erd
\end_inset

 function described earlier, in Sect.
\begin_inset space ~
\end_inset

5.
\end_layout

\begin_layout Enumerate
Manuscript Sect.
\begin_inset space ~
\end_inset

4.1.3 provides some estimates of the uncertainty in the pitch correction.
 One estimate quoted without justification is the estimate that the uncertainty
 in the pitch correction arising from the uncertainty in determining the
 derivatives is smaller than 0.0001
\begin_inset Formula $^{\circ}$
\end_inset

.
 Some elaboration leading to that estimate is presented here.
 Modern GPS receivers, especially if augmented by special signals or special
 processing, produce 1-Hz measurements with uncertainty of around 0.03
\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-1}$
\end_inset

(
\begin_inset CommandInset citation
LatexCommand citet
key "Cooper2016ncartn"

\end_inset

).
 The consistency of the Schuler oscillation, as illustrated by the top panel
 in Fig.
\begin_inset space ~
\end_inset

1, suggests that derivatives in velocity can be determined by averaging
 over periods of at least 10 min or more, so if the ground-speed measurements
 from the INS have uncertainty of about 0.03
\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-1}$
\end_inset

 (where variance spectra for the 1-Hz measurements begin to show noise),
 the uncertainty in differences between these two signals might be expected
 to be 
\begin_inset Formula $0.03\,\sqrt{2}\approx0.04$
\end_inset


\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-1}$
\end_inset

, and averaged over 10
\begin_inset space ~
\end_inset

min or perhaps 60 autocorrelation times the resulting difference could be
 resolved to 
\begin_inset Formula $0.04/\sqrt{60}\approx0.005$
\end_inset


\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-1}$
\end_inset

.
 Over intervals separated by 10
\begin_inset space \thinspace{}
\end_inset

min, the derivative then might be determined to 
\begin_inset Formula $0.005\times1/600\approx10^{-5}$
\end_inset


\begin_inset space \thinspace{}
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

, leading to an uncertainty in the pitch correction from manuscript Eqn.
\begin_inset space ~
\end_inset

(2) of about 10
\begin_inset Formula $^{-6}$
\end_inset

 or 0.00005
\begin_inset Formula $^{\circ}$
\end_inset

.
 S-G polynomials reduce noise in an average by a factor of 
\begin_inset Formula $\sqrt{(3(3m^{2}-7)/4m(m^{2}-4)}\simeq0.05$
\end_inset

 for m=1013 or 
\begin_inset Formula $0.06$
\end_inset

 for m=601.
 Then for 
\begin_inset Formula $0.04*0.06=0.0024$
\end_inset

m/s, 600-s separation gives acceleration uncertainty of about 
\begin_inset Formula $0.0024/600=4e-6$
\end_inset

 or pitch uncertainty of 2e-5
\begin_inset Formula $^{\circ}$
\end_inset

.
 That is the reason that this potential contribution to uncertainty in the
 correction has been neglected.
\end_layout

\begin_layout Subsection*
The heading correction
\end_layout

\begin_layout Standard
This subsection just references earlier results and notes a relevant result
 from the Technical Note.
\end_layout

\begin_layout Section*
Applanix studies
\end_layout

\begin_layout Standard
Mention is included here of an attempt to use an INS with incorporated Kalman
 filter as a reference, even though that did not prove useful.
 During the DEEPWAVE project, files from an Applanix INS were recorded at
 10
\begin_inset space ~
\end_inset

Hz, so those can be compared to the measurements from the standard Honeywell
 IRS without Kalman filtering but adjusted using the procedures developed
 in this note.
 Several problems were encountered when attempting to use the measurements
 from the Applanix, so this line of investigation was abandoned, although
 it may be worth further investigation, especially because there are post-proces
sing steps available for the Applanix unit that improve the measurements.
 Without such post-processing, these problems led to difficulties:
\end_layout

\begin_layout Enumerate
The Applanix and Honeywell units were evidently installed with mean differences
 in orientation of about 0.1
\begin_inset Formula $^{\circ}$
\end_inset

 in all three attitude angles.
 Because the heading algorithm applied to the Honeywell measurements indicated
 a net offset, it was unresolved if the difference arose from installation
 differences or from IRS differences.
 The corrected heading from the Honeywell IRS differed from the Applanix
 heading more than the uncorrected heading from the Honeywell IRS, but it
 could be the case that this indicates an installation-angle difference.
 The standard deviation of the differences of the corrected or uncorrected
 Honeywell heading vs the Applanix heading were essentially the same.
\end_layout

\begin_layout Enumerate
The available measurements included body accelerations and components labeled
 as x, y, and z velocity and x, y, and z body acceleration, but these don't
 match any of the velocities or accelerations (body or local) determined
 from the Honeywell system, so it is unclear what these represent.
 For example, they can't be used to determine the orientation of the Applanix
 system by comparing ground-speed components to those determined from the
 GPS because the measurements do not appear to be valid representations
 of the ground-speed components.
 
\end_layout

\begin_layout Subsection*

\lang british
\begin_inset Note Note
status open

\begin_layout Subsection*
Data Derivation Graph
\end_layout

\begin_layout Plain Layout
In case it will be useful, the structure of the R code in this routine is
 also presented here in a DDG (Data Derivation Graph) format, generated
 using the R package RDataTracker
\begin_inset Foot
status open

\begin_layout Plain Layout
Lerner B, Boose E, Ellison A, Osterweil L.
 2014.
 Scientific Data Provenance in R: RDataTracker and DDG Explorer.
 Harvard Forest Data Archive: HF091.
\end_layout

\end_inset

 and the java routine DDGExplorer
\begin_inset Foot
status open

\begin_layout Plain Layout
ibid.
\end_layout

\end_inset

.
 Two plots are presented, one a high-level plot showing the individual R
 
\begin_inset Quotes eld
\end_inset

chunks
\begin_inset Quotes erd
\end_inset

 and another providing an expanded view of the filtering step in chunk 
\begin_inset Quotes eld
\end_inset

filter-WIC
\begin_inset Quotes erd
\end_inset

.
 The other sections can also be expanded to provide more detail.
 This is available by running DDGExplorer.jar and selecting the file 
\begin_inset Quotes eld
\end_inset

FilterForWIC.R
\begin_inset Quotes erd
\end_inset

 with time-tag 2015-10-22T00.58.54MDT, saved in the directory ~cooperw/.ddg
 on tikal.eol.ucar.edu.
 That provides an interactive display that can be used to check values of
 variables, expand or collapse sections (via mouse right-click), move or
 rearrange the diagram, etc.
\end_layout

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset Graphics
	filename ../../../Reprocessing/DDGExplorerFilterForWIC1.png
	lyxscale 50
	width 95text%

\end_inset


\end_layout

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset Graphics
	filename ../../../Reprocessing/DDGExplorerFilterForWIC2.png
	lyxscale 50
	width 95text%

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "../../AMTD-AAC/WAC"
options "copernicus"

\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center

\family sans
\color blue
– End of Memo –
\end_layout

\begin_layout Standard
Reproducibility information for the manuscript:
\begin_inset Note Note
status open

\begin_layout Plain Layout
include enough info to re-run.
 in zip, include program, pdf if not too big, and subset data, not entire
 file.
 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="8" columns="2">
<features tabularvalignment="middle">
<column alignment="left" valignment="top" width="0pt">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Project:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

AMTD-AAC
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Archive package:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

AMTD-AAC.zip
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Contains:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
attachment list below
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Program:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

AMTD-AAC.Rnw
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Original Data:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

/scr/raf/Prod
\backslash
_Data/DEEPWAVE
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Subset Data:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NCAR HPSS; contact NCAR/EOL/RAF data management
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Workflow:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{thisFileName}.pdf
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Git:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

https://github.com/WilliamCooper/AMTD-AAC.git
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
attachm{AMTD-AAC.Rnw
\backslash

\backslash
AMTD-AAC.pdf
\backslash

\backslash
SessionInfo}
\end_layout

\begin_layout Plain Layout

%
\backslash
cc{first attachment
\backslash

\backslash
second
\backslash

\backslash
3rd att}
\end_layout

\begin_layout Plain Layout

%
\backslash
attach{attachment}
\end_layout

\begin_layout Plain Layout

%
\backslash
attachm{first
\backslash

\backslash
second} %
\backslash
cc{first attachment
\backslash

\backslash
second
\backslash

\backslash
3rd att}
\end_layout

\begin_layout Plain Layout

<<save-system-info, echo=FALSE>>= 
\end_layout

\begin_layout Plain Layout

cat (toLatex(sessionInfo()), file="SessionInfo")
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@ 
\end_layout

\begin_layout Plain Layout

<<make-zip-archive, echo=TRUE, INCLUDE=TRUE>>=
\end_layout

\begin_layout Plain Layout

system (sprintf("zip AMTD-AAC.zip AMTD-AAC.Rnw AMTD-AAC.pdf WorkflowAttitudeAngleNo
te.pdf SessionInfo"))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@ 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

% 
\backslash
attach{attachment}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% 
\backslash
attachm{ProgramFile
\backslash

\backslash
Document.pdf
\backslash

\backslash
SaveRData}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

%
\backslash
cc{first attachment
\backslash

\backslash
second
\backslash

\backslash
3rd att}
\end_layout

\end_inset


\end_layout

\end_body
\end_document
